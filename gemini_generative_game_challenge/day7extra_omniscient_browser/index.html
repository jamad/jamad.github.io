<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Deca-Search v3: Selector UI</title>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Inter:wght@400;600&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', 'Noto Sans JP', sans-serif; background-color: #020617; color: #e2e8f0; overflow: hidden; touch-action: none; }
        .mono-font { font-family: 'Share Tech Mono', monospace; }
        
        /* Slider Styling */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; cursor: pointer; outline: none; z-index: 20; }
        /* Thumb invisible but clickable (we draw a custom ghost thumb) */
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 100%; width: 48px; background: transparent; cursor: ew-resize; z-index: 30; position: relative; }
        
        .scanline { background: linear-gradient(to bottom, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0.2) 50%, rgba(0, 0, 0, 0.2) 100%); background-size: 100% 4px; pointer-events: none; }
        .grid-cell { transition: all 0.2s ease-out; border: 1px solid #1e293b; }
        .grid-cell:hover { background-color: #0f172a; border-color: #06b6d4; transform: translateY(-2px); z-index: 20; }
        
        /* Button Active Glow */
        .btn-active { background-color: rgba(6, 182, 212, 0.2); border-color: #06b6d4; color: #22d3ee; box-shadow: 0 0 15px rgba(6, 182, 212, 0.3); }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const BASE = 10;
        const STEPS = 100;

        // Sector Definitions for Buttons
        const SECTORS = [
            { id: 0, label: "GEN", full: "GENERAL", desc: "Standard English" },
            { id: 1, label: "MED", full: "MEDICAL", desc: "Diseases & Anatomy" },
            { id: 2, label: "BIO", full: "BIOLOGY", desc: "Taxonomy & Species" },
            { id: 3, label: "CHEM", full: "CHEMICAL", desc: "Elements & Compounds" },
        ];

        // Levels (L0 Removed from slider list, handled separately)
        const SLIDERS = [
            { idx: 1, name: "GRAND", pow: 7, color: "from-indigo-950 to-blue-900", freq: 60 },
            { idx: 2, name: "MAJOR", pow: 5, color: "from-blue-900 to-cyan-900", freq: 100 },
            { idx: 3, name: "MINOR", pow: 3, color: "from-cyan-900 to-teal-900", freq: 200 },
            { idx: 4, name: "PATCH", pow: 1, color: "from-teal-900 to-emerald-900", freq: 400 },
        ];

        // L0 is 10^9
        const MULTIPLIERS = [Math.pow(10, 9), Math.pow(10, 7), Math.pow(10, 5), Math.pow(10, 3), Math.pow(10, 1)];

        const AudioEngine = {
            ctx: null,
            init: () => { if (!AudioEngine.ctx) AudioEngine.ctx = new (window.AudioContext || window.webkitAudioContext)(); if (AudioEngine.ctx.state === 'suspended') AudioEngine.ctx.resume(); },
            playTick: (freq) => {
                if (!AudioEngine.ctx) return;
                const t = AudioEngine.ctx.currentTime;
                const osc = AudioEngine.ctx.createOscillator();
                const gain = AudioEngine.ctx.createGain();
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(freq, t);
                osc.frequency.exponentialRampToValueAtTime(freq * 0.5, t + 0.1);
                gain.gain.setValueAtTime(0, t);
                gain.gain.linearRampToValueAtTime(0.05, t + 0.01);
                gain.gain.exponentialRampToValueAtTime(0.001, t + 0.1);
                osc.connect(gain);
                gain.connect(AudioEngine.ctx.destination);
                osc.start(t); osc.stop(t + 0.15);
            }
        };

        const App = () => {
            // positions[0] = Sector, positions[1..4] = Sliders
            const [positions, setPositions] = useState([0, 0, 0, 0, 0]);
            const [dataMap, setDataMap] = useState({});
            const [audioReady, setAudioReady] = useState(false);
            const [activeRow, setActiveRow] = useState(null); // active slider index
            
            const [loadState, setLoadState] = useState("INITIALIZING");
            const [totalCount, setTotalCount] = useState(0);

            useEffect(() => {
                const loadData = async () => {
                    try {
                        setLoadState("LOADING...");
                        const response = await fetch('data.json');
                        if (response.ok) {
                            const json = await response.json();
                            if (json && json.items) {
                                setDataMap(json.items);
                                setTotalCount(Object.keys(json.items).length);
                                setLoadState("ONLINE");
                            }
                        } else { setLoadState("ERR: CONN"); }
                    } catch (err) { setLoadState("OFFLINE"); }
                };
                loadData();
            }, []);

            const enableAudio = () => { if (!audioReady) { AudioEngine.init(); setAudioReady(true); } };

            const globalIndex = useMemo(() => {
                return positions.reduce((acc, pos, idx) => acc + (pos * MULTIPLIERS[idx]), 0);
            }, [positions]);

            const handleSectorClick = (sectorId) => {
                enableAudio();
                const newPos = [...positions];
                newPos[0] = sectorId;
                setPositions(newPos);
                AudioEngine.playTick(40); // Base sound
            };

            const handleSlide = (arrIdx, val) => {
                enableAudio();
                const numVal = parseInt(val, 10);
                if (positions[arrIdx] !== numVal) {
                    const newPos = [...positions];
                    newPos[arrIdx] = numVal;
                    setPositions(newPos);
                    setActiveRow(arrIdx);
                    // Frequency based on slider level
                    const freq = SLIDERS.find(s => s.idx === arrIdx)?.freq || 100;
                    AudioEngine.playTick(freq);
                    setTimeout(() => setActiveRow(null), 200);
                }
            };

            const getDisplayData = (offset) => {
                const targetIdx = globalIndex + offset;
                const key = targetIdx.toString();
                if (dataMap[key]) {
                    return { value: dataMap[key], type: dataMap[key].sector || 'DATA', highlight: true, isDict: true };
                }
                return { value: `SEC::${(targetIdx * 12345).toString(16).toUpperCase().slice(0,8)}`, type: 'VOID', highlight: false, isDict: false };
            };

            const currentSector = SECTORS.find(s => s.id === positions[0]) || SECTORS[0];

            return (
                <div className="flex flex-col h-screen w-screen bg-slate-950 text-slate-300 relative" onClick={enableAudio}>
                    {/* Header */}
                    <header className="flex-none h-12 border-b border-slate-800 flex items-center justify-between px-4 z-20 bg-slate-950/90 backdrop-blur">
                        <div className="flex items-center gap-2">
                            <div className={`w-2 h-2 rounded-full ${audioReady ? 'bg-cyan-500 shadow-[0_0_10px_cyan]' : 'bg-slate-600 animate-pulse'}`}></div>
                            <h1 className="mono-font text-sm md:text-base font-bold text-cyan-500 tracking-wider">DECA-SEARCH v3</h1>
                        </div>
                        <div className="text-right">
                            <div className="text-[10px] md:text-xs text-cyan-400 mono-font font-bold">{currentSector.full}</div>
                            <div className="text-[9px] text-slate-500 mono-font">{totalCount > 0 ? `${totalCount.toLocaleString()} RECS` : loadState}</div>
                        </div>
                    </header>

                    {/* --- CONTROL AREA --- */}
                    <section className="flex-1 flex flex-col relative z-10 min-h-0 border-b border-slate-800 shadow-xl">
                        
                        {/* 1. SECTOR SELECTOR (L0 Replacement) */}
                        <div className="h-16 flex border-b border-slate-800/50 bg-slate-900/50">
                            {SECTORS.map((s) => {
                                const isActive = positions[0] === s.id;
                                return (
                                    <button
                                        key={s.id}
                                        onClick={() => handleSectorClick(s.id)}
                                        className={`flex-1 flex flex-col items-center justify-center border-r border-slate-800/50 transition-all duration-200 group
                                            ${isActive ? 'btn-active z-10' : 'hover:bg-slate-800/50 text-slate-500'}
                                        `}
                                    >
                                        <span className={`text-xs md:text-sm font-bold tracking-widest ${isActive ? 'text-cyan-300' : 'text-slate-400'}`}>{s.label}</span>
                                        <span className="text-[8px] md:text-[9px] opacity-70 mono-font mt-1">{s.desc}</span>
                                    </button>
                                );
                            })}
                        </div>

                        {/* 2. SLIDERS (L1 - L4) */}
                        {SLIDERS.map((lvl) => {
                            const val = positions[lvl.idx];
                            return (
                                <div key={lvl.idx} className="flex-1 relative border-b border-slate-800/50 last:border-0 group">
                                    <div className={`absolute inset-0 bg-gradient-to-r ${lvl.color} opacity-10 transition-opacity duration-300 ${activeRow === lvl.idx ? 'opacity-30' : ''}`}></div>

                                    {/* Left Label Area */}
                                    <div className="absolute left-0 top-0 bottom-0 w-24 bg-slate-950/30 border-r border-slate-800/30 flex flex-col justify-center px-3 z-10 pointer-events-none">
                                        <span className="text-[10px] font-bold text-cyan-700 tracking-widest leading-none">L{lvl.idx}</span>
                                        <span className="text-xs md:text-sm font-semibold text-slate-400 group-hover:text-slate-200 transition-colors mt-1">{lvl.name}</span>
                                        <span className="text-[9px] text-slate-600 mono-font mt-0.5">x10^{lvl.pow}</span>
                                    </div>

                                    {/* Slider Track Area */}
                                    <div className="absolute left-24 right-0 top-0 bottom-0">
                                        
                                        {/* Input */}
                                        <input
                                            type="range"
                                            min="0"
                                            max={STEPS - 1}
                                            value={val}
                                            onChange={(e) => handleSlide(lvl.idx, e.target.value)}
                                            className="relative w-full h-full opacity-0 group-hover:opacity-100 transition-opacity duration-200"
                                        />

                                        {/* Visual Track Line */}
                                        <div className="absolute inset-x-0 h-[1px] bg-slate-700/30 top-1/2 -translate-y-1/2 pointer-events-none mx-4"></div>

                                        {/* Custom Thumb & Floating Value */}
                                        <div
                                            className="absolute top-0 bottom-0 pointer-events-none transition-all duration-100"
                                            style={{
                                                left: `calc(${(val / (STEPS - 1)) * 100}% - 24px + 24px)`, /* Center correction */
                                                transform: 'translateX(-50%)', // Center the element
                                                width: '48px'
                                            }}
                                        >
                                            {/* The Ghost Thumb Bar */}
                                            <div className="h-full w-1 mx-auto bg-cyan-600/50 group-hover:bg-cyan-500/80 transition-colors"></div>
                                            
                                            {/* Floating Value Label (Above) */}
                                            <div className="absolute -top-1 left-1/2 -translate-x-1/2 bg-slate-900 border border-cyan-800 text-cyan-400 text-xs font-bold px-2 py-0.5 rounded shadow-[0_0_10px_rgba(0,0,0,0.5)] mono-font z-40">
                                                {String(val).padStart(2, '0')}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                    </section>

                    {/* --- GRID --- */}
                    <section className="h-[40vh] bg-slate-950 relative z-10 p-2 border-t border-cyan-900/30">
                        <div className="h-full w-full grid grid-cols-5 grid-rows-2 gap-2">
                            {Array.from({ length: 10 }).map((_, offset) => {
                                const data = getDisplayData(offset);
                                const isDict = data.isDict;
                                return (
                                    <div key={offset} className={`grid-cell relative rounded p-2 flex flex-col justify-between overflow-hidden ${data.highlight ? 'bg-cyan-950/30 border-cyan-700' : 'bg-slate-900/50'}`}>
                                        <div className="flex justify-between items-start text-[8px] md:text-[10px] text-slate-500">
                                            <span className="mono-font text-slate-400">+{offset}</span>
                                            <span className="mono-font opacity-50">{data.type}</span>
                                        </div>
                                        <div className="flex-1 flex flex-col items-center justify-center text-center overflow-hidden w-full">
                                            {isDict ? (
                                                <div className="w-full animate-in fade-in duration-75">
                                                    <div className="text-cyan-100 text-sm md:text-lg font-bold mb-1 truncate leading-none pb-1">{data.value.en}</div>
                                                    <div className="text-cyan-500 text-[10px] md:text-xs truncate leading-tight">{data.value.fi}</div>
                                                    <div className="text-slate-400 text-[10px] md:text-xs truncate leading-tight font-sans">{data.value.ja}</div>
                                                </div>
                                            ) : (
                                                <div className="text-slate-600 text-xs md:text-sm mono-font font-bold break-all leading-tight opacity-50">
                                                    {data.value}
                                                </div>
                                            )}
                                        </div>
                                        <div className="text-[8px] text-slate-700 text-center truncate">ID: {(globalIndex + offset).toString()}</div>
                                        {data.highlight && <div className="absolute top-0 right-0 w-2 h-2 bg-cyan-500 shadow-[0_0_10px_rgba(6,182,212,0.8)]"></div>}
                                    </div>
                                );
                            })}
                        </div>
                    </section>
                    
                    <div className="absolute inset-0 pointer-events-none z-30 scanline opacity-20"></div>

                    {!audioReady && (
                        <div className="absolute inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center">
                            <div className="border border-cyan-900 bg-slate-900/90 p-6 max-w-sm text-center shadow-2xl rounded-sm">
                                <h2 className="text-cyan-500 text-xl font-bold mb-2 mono-font tracking-widest">DECA-SEARCH v3</h2>
                                <p className="text-slate-400 text-sm mb-6 leading-relaxed">
                                    System Initialized.<br/>
                                    Select Sector to Begin.
                                </p>
                                <button className="px-6 py-2 bg-cyan-900/50 hover:bg-cyan-800 text-cyan-200 text-sm font-bold border border-cyan-700 tracking-wider transition-all shadow-[0_0_15px_rgba(6,182,212,0.3)]">
                                    [ ACTIVATE ]
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>