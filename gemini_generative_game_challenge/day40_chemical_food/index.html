<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Addit-Lab âœ¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap');
        
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #FFD1DC 0%, #E6E6FA 50%, #B4E7CE 100%);
            background-attachment: fixed;
            touch-action: manipulation;
            overflow: hidden;
        }

        .game-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 20px 60px rgba(255, 192, 203, 0.3);
            backdrop-filter: blur(10px);
        }

        @media (min-width: 768px) and (orientation: landscape) {
            .game-container {
                flex-direction: row;
                height: 92vh;
                margin-top: 4vh;
                border-radius: 30px;
            }
            .panel-left { width: 50%; border-right: 3px solid rgba(255, 209, 220, 0.3); }
            .panel-right { width: 50%; }
        }

        .food-display { 
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            filter: drop-shadow(0 5px 15px rgba(255, 182, 193, 0.4));
        }
        
        .toxic-glow {
            filter: drop-shadow(0 0 20px #00ff00) drop-shadow(0 0 40px #00ff00);
            animation: pulse 1s infinite;
        }
        .tasty-glow { 
            filter: drop-shadow(0 0 20px #FFD700) drop-shadow(0 0 30px #FFA500);
        }
        .warning-glow {
            filter: drop-shadow(0 0 15px #FF6B6B);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.08); }
            100% { transform: scale(1); }
        }
        @keyframes float {
            0% { transform: translateY(0px) rotate(-2deg); }
            50% { transform: translateY(-15px) rotate(2deg); }
            100% { transform: translateY(0px) rotate(-2deg); }
        }
        .floating { animation: float 3.5s ease-in-out infinite; }

        .pop-anim { animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop {
            0% { transform: scale(0.85); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }

        .stat-bar-fill { transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.3s; }
        .btn-press { transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1); }
        .btn-press:active { transform: scale(0.93); }
        .btn-press:hover { transform: translateY(-2px); }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .modal-overlay {
            background: linear-gradient(135deg, rgba(255, 209, 220, 0.95), rgba(230, 230, 250, 0.95));
            backdrop-filter: blur(10px);
        }

        .cost-text {
            animation: fadeUp 1.2s forwards;
            font-weight: 800;
        }
        @keyframes fadeUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            50% { transform: translateY(-15px) scale(1.1); }
            100% { opacity: 0; transform: translateY(-30px) scale(0.8); }
        }

        .ingredient-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
            border: 2px solid;
            border-radius: 16px;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .ingredient-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 245, 250, 0.9));
            border: 2px solid rgba(255, 192, 203, 0.3);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .warning-badge {
            background: linear-gradient(135deg, #FF6B6B, #FFB6C1);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 800;
            display: inline-block;
            margin: 2px;
        }

        .header-gradient {
            background: linear-gradient(135deg, #FFD1DC 0%, #E6E6FA 100%);
        }
    </style>
</head>
<body class="text-slate-700 select-none">

    <div class="game-container relative overflow-hidden">
        
        <div class="absolute top-4 right-4 z-50">
            <select id="langSelect" onchange="game.setLanguage(this.value)" class="bg-white/90 backdrop-blur border-2 border-pink-200 text-slate-700 text-sm rounded-full px-3 py-2 focus:outline-none focus:border-pink-400 font-bold shadow-lg">
                <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                <option value="fi">ğŸ‡«ğŸ‡® Suomi</option>
                <option value="da">ğŸ‡©ğŸ‡° Dansk</option>
            </select>
        </div>

        <div class="panel-left flex flex-col p-5 header-gradient flex-grow relative z-10">
            <div class="flex justify-between items-center mb-6 pr-20">
                <div class="bg-white/90 px-5 py-3 rounded-full shadow-lg border-2 border-green-200">
                    <span id="labelMoney" class="text-xs text-green-500 font-bold block tracking-wider">è³‡é‡‘</span>
                    <span id="moneyDisplay" class="text-2xl font-black text-green-600">Â¥ 1,000,000</span>
                </div>
                <div class="bg-white/90 px-5 py-3 rounded-full shadow-lg border-2 border-yellow-200">
                    <span id="labelReputation" class="text-xs text-yellow-500 font-bold block tracking-wider">è©•åˆ¤</span>
                    <span id="reputationDisplay" class="text-2xl font-black text-yellow-600">â˜… 3.0</span>
                </div>
            </div>

            <div class="flex-grow flex flex-col justify-center items-center relative py-6">
                <div class="absolute inset-0 flex justify-center items-center opacity-10 pointer-events-none">
                    <svg width="350" height="350" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="45" stroke="url(#gradient1)" stroke-width="1.5" fill="none" stroke-dasharray="8,4" />
                        <circle cx="50" cy="50" r="35" stroke="url(#gradient1)" stroke-width="1" fill="none" />
                        <defs>
                            <linearGradient id="gradient1" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#FFD1DC;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#E6E6FA;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                
                <div id="foodEmoji" class="text-9xl mb-4 floating food-display cursor-pointer transition-transform">ğŸ¥£</div>
                <h2 id="foodName" class="text-3xl font-black text-slate-800 mb-2">ç©ºã®ãƒœã‚¦ãƒ«</h2>
                <div id="labelBaseFood" class="text-sm text-slate-500 font-semibold mt-1 min-h-[1.25rem]">æ··åˆç‰©</div>
                <div id="warningBadges" class="mt-2 flex flex-wrap gap-1 justify-center max-w-xs"></div>

                <div id="floatingCostContainer" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none"></div>

                <div class="w-full max-w-sm mt-6 space-y-3 stat-card p-5">
                    <div>
                        <div class="flex justify-between text-xs mb-1.5">
                            <span id="labelFlavor" class="font-bold text-orange-600">ğŸ­ å‘³ãƒ»ä¸­æ¯’æ€§</span>
                            <span id="valFlavor" class="font-black text-orange-600">0</span>
                        </div>
                        <div class="h-3 bg-orange-100 rounded-full overflow-hidden shadow-inner">
                            <div id="barFlavor" class="stat-bar-fill h-full bg-gradient-to-r from-orange-300 to-orange-500" style="width: 0%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between text-xs mb-1.5">
                            <span id="labelAppearance" class="font-bold text-pink-600">âœ¨ è¦‹ãŸç›®ãƒ»æ˜ ãˆ</span>
                            <span id="valAppearance" class="font-black text-pink-600">0</span>
                        </div>
                        <div class="h-3 bg-pink-100 rounded-full overflow-hidden shadow-inner">
                            <div id="barAppearance" class="stat-bar-fill h-full bg-gradient-to-r from-pink-300 to-pink-500" style="width: 0%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between text-xs mb-1.5">
                            <span id="labelSafety" class="font-bold text-green-600">ğŸ’š å¥åº·ãƒªã‚¹ã‚¯</span>
                            <span id="valSafety" class="font-black text-green-600">100</span>
                        </div>
                        <div class="h-3 bg-green-100 rounded-full overflow-hidden shadow-inner">
                            <div id="barSafety" class="stat-bar-fill h-full bg-gradient-to-r from-green-300 to-green-500" style="width: 100%"></div>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-2 pt-2 border-t border-pink-200">
                        <div class="text-center">
                            <div class="text-[10px] text-slate-400 font-bold">ãƒˆãƒ©ãƒ³ã‚¹è„‚è‚ª</div>
                            <div id="valTransFat" class="text-sm font-black text-red-500">0g</div>
                        </div>
                        <div class="text-center">
                            <div class="text-[10px] text-slate-400 font-bold">ãƒŠãƒˆãƒªã‚¦ãƒ </div>
                            <div id="valSodium" class="text-sm font-black text-orange-500">0mg</div>
                        </div>
                        <div class="text-center">
                            <div class="text-[10px] text-slate-400 font-bold">ç³–è³ª</div>
                            <div id="valSugar" class="text-sm font-black text-purple-500">0g</div>
                        </div>
                    </div>
                    <div class="pt-2">
                        <div class="flex justify-between text-xs mb-1.5">
                            <span id="labelCost" class="font-bold text-blue-600">ğŸ’° è£½é€ ã‚³ã‚¹ãƒˆ</span>
                            <span id="valCost" class="font-black text-blue-600">0</span>
                        </div>
                        <div class="h-3 bg-blue-100 rounded-full overflow-hidden shadow-inner">
                            <div id="barCost" class="stat-bar-fill h-full bg-gradient-to-r from-blue-300 to-blue-500" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel-right bg-white border-t-4 border-pink-200 flex flex-col z-20 shadow-[0_-5px_25px_rgba(255,182,193,0.2)] h-[50vh] md:h-auto">
            
            <div class="flex justify-between items-center px-5 pt-3 pb-2 bg-gradient-to-r from-pink-50 to-purple-50 border-b-2 border-pink-100">
                <h3 id="labelIngredientsTitle" class="font-black text-pink-600 text-base">ğŸ§ª åŸææ–™ & æ·»åŠ ç‰©</h3>
                <button id="btnReset" onclick="game.resetFood()" class="text-xs text-red-400 hover:text-red-600 font-bold underline">ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
            
            <div class="flex-grow overflow-y-auto p-4 space-y-4 no-scrollbar">
                
                <div>
                    <h4 id="headerBase" class="text-xs font-black text-pink-400 uppercase mb-3 tracking-widest">ğŸ¥¤ ãƒ™ãƒ¼ã‚¹ç´ æ</h4>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="game.addIngredient('water')" class="ingredient-card btn-press border-blue-300 hover:border-blue-400 p-2.5 flex items-center gap-2 text-left">
                            <div class="text-2xl">ğŸ’§</div>
                            <div class="leading-tight flex-1">
                                <div class="font-bold text-sm text-blue-700">æ°´</div>
                                <div class="text-[9px] text-slate-400 font-semibold">+Â¥5</div>
                            </div>
                        </button>
                        <button onclick="game.addIngredient('carbonated')" class="ingredient-card btn-press border-cyan-300 hover:border-cyan-400 p-2.5 flex items-center gap-2 text-left">
                            <div class="text-2xl">ğŸ«§</div>
                            <div class="leading-tight flex-1">
                                <div class="font-bold text-sm text-cyan-700">ç‚­é…¸æ°´</div>
                                <div class="text-[9px] text-slate-400 font-semibold">+Â¥8</div>
                            </div>
                        </button>
                        <button onclick="game.addIngredient('flour')" class="ingredient-card btn-press border-yellow-300 hover:border-yellow-400 p-2.5 flex items-center gap-2 text-left">
                            <div class="text-2xl">ğŸŒ¾</div>
                            <div class="leading-tight flex-1">
                                <div class="font-bold text-sm text-yellow-700">å°éº¦ç²‰</div>
                                <div class="text-[9px] text-slate-400 font-semibold">+Â¥10</div>
                            </div>
                        </button>
                        <button onclick="game.addIngredient('oil')" class="ingredient-card btn-press border-amber-300 hover:border-amber-400 p-2.5 flex items-center gap-2 text-left">
                            <div class="text-2xl">ğŸ§ˆ</div>
                            <div class="leading-tight flex-1">
                                <div class="font-bold text-sm text-amber-700">æ¤ç‰©æ²¹è„‚</div>
                                <div class="text-[9px] text-slate-400 font-semibold">+Â¥12</div>
                            </div>
                        </button>
                        <button onclick="game.addIngredient('meat')" class="ingredient-card btn-press border-red-300 hover:border-red-400 p-2.5 flex items-center gap-2 text-left">
                            <div class="text-2xl">ğŸ¥©</div>
                            <div class="leading-tight flex-1">
                                <div class="font-bold text-sm text-red-700">è‚‰ãƒšãƒ¼ã‚¹ãƒˆ</div>
                                <div class="text-[9px] text-slate-400 font-semibold">+Â¥35</div>
                            </div>
                        </button>
                        <button onclick="game.addIngredient('gelatin')" class="ingredient-card btn-press border-orange-300 hover:border-orange-400 p-2.5 flex items-center gap-2 text-left">
                            <div class="text-2xl">ğŸ¦´</div>
                            <div class="leading-tight flex-1">
                                <div class="font-bold text-sm text-orange-700">ã‚¼ãƒ©ãƒãƒ³</div>
                                <div class="text-[9px] text-slate-400 font-semibold">+Â¥15</div>
                            </div>
                        </button>
                    </div>
                </div>

                <div>
                    <h4 class="text-xs font-black text-purple-400 uppercase mb-3 tracking-widest">ğŸ¬ ç”˜å‘³æ–™ãƒ»é…¸å‘³æ–™</h4>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="game.addAdditive('hfcs')" class="ingredient-card btn-press border-purple-300 hover:border-purple-400 p-2.5 flex items-center gap-2 text-left">
                            <div class="text-xl bg-purple-100 rounded-full w-8 h-8 flex items-center justify-center shadow-sm">ğŸ¯</div>
                            <div class="leading-tight flex-1">
                                <div class="font-bold text-[11px] text-purple-700">ãƒ–ãƒ‰ã‚¦ç³–æœç³–æ¶²ç³–</div>
                                <div class="text-[9px] text-red-500 font-bold">-Â¥1,200</div>
                            </div>
                        </button>
                        <button onclick="game.addAdditive('aspartame')" class="ingredient-card btn-press border-pink-300 hover:border-pink-400 p-2.5 flex items-center gap-2 text-left">
                            <div class="text-xl bg-pink-100 rounded-full w-8 h-8 flex items-center justify-center shadow-sm">ğŸ’Š</div>
                            <div class="leading-tight flex-1">
                                <div class="font-bold text-[11px] text-pink-700">ã‚¢ã‚¹ãƒ‘ãƒ«ãƒ†ãƒ¼ãƒ </div>
                                <div class="text-[9px] text-red-500 font-bold">-Â¥2,000</div>
                            </div>
                        </button>
                        <button onclick="game.addAdditive('acesulfame')" class="ingredient-card btn-press border-fuchsia-300 hover:border-fuchsia-400 p-2.5 flex items-center gap-2 text-left">
                            <div class="text-xl bg-fuchsia-100 rounded-full w-8 h-8 flex items-center justify-center shadow-sm">ğŸ§</div>
                            <div class="leading-tight flex-1">
                                <div class="font-bold text-[11px] text-fuchsia-700">ã‚¢ã‚»ã‚¹ãƒ«ãƒ•ã‚¡ãƒ K</div>
                                <div class="text-[9px] text-red-500 font-bold">-Â¥1,800</div>
                            </div>
                        </button>
                        <button onclick="game.addAdditive('citric')" class="ingredient-card btn-press border-lime-300 hover:border-lime-400 p-2.5 flex items-center gap-2 text-left">
                            <div class="text-xl bg-lime-100 rounded-full w-8 h-8 flex items-center justify-center shadow-sm">ğŸ‹</div>
                            <div class="leading-tight flex-1">
                                <div class="font-bold text-[11px] text-lime-700">ã‚¯ã‚¨ãƒ³é…¸</div>
                                <div class="text-[9px] text-red-500 font-bold">-Â¥800</div>
                            </div>
                        </button>
                    </div>
                </div>

                <div>
                    <h4 class="text-xs font-black text-rose-400 uppercase mb-3 tracking-widest">ğŸ¨ ç€è‰²æ–™ãƒ»é¦™æ–™</h4>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="game.addAdditive('color')" class="ingredient-card btn-press border-rose-300 hover:border-rose-400 p-2.5 flex items-center gap-2 text-left">
                            <div class="text-xl bg-rose-100 rounded-full w-8 h-8 flex items-center justify-center shadow-sm">ğŸ¨</div>
                            <div class="leading-tight flex-1">
                                <div class="font-bold text-[11px] text-rose-700">åˆæˆç€è‰²æ–™</div>
                                <div class="text-[9px] text-red-500 font-bold">-Â¥1,000</div>
                            </div>
                        </button>
                        <button onclick="game.addAdditive('caramel')" class="ingredient-card btn-press border-amber-300 hover:border-amber-400 p-2.5 flex items-center gap-2 text-left">
                            <div class="text-xl bg-amber-100 rounded-full w-8 h-8 flex items-center justify-center shadow-sm">ğŸ®</div>
                            <div class="leading-tight flex-1">
                                <div class="font-bold text-[11px] text-amber-700">ã‚«ãƒ©ãƒ¡ãƒ«è‰²ç´ </div>
                                <div class="text-[9px] text-red-500 font-bold">-Â¥900</div>
                            </div>
                        </button>
                        <button onclick="game.addAdditive('flavor')" class="ingredient-card btn-press border-violet-300 hover:border-violet-400 p-2.5 flex items-center gap-2 text-left">
                            <div class="text-xl bg-violet-100 rounded-full w-8 h-8 flex items-center justify-center shadow-sm">ğŸŒ¸</div>
                            <div class="leading-tight flex-1">
                                <div class="font-bold text-[11px] text-violet-700">é¦™æ–™</div>
                                <div class="text-[9px] text-red-500 font-bold">-Â¥1,500</div>
                            </div>
                        </button>
                        <button onclick="game.addAdditive('msg')" class="ingredient-card btn-press border-orange-300 hover:border-orange-400 p-2.5 flex items-center gap-2 text-left">
                            <div class="text-xl bg-orange-100 rounded-full w-8 h-8 flex items-center justify-center shadow-sm">ğŸ§‚</div>
                            <div class="leading-tight flex-1">
                                <div class="font-bold text-[11px] text-orange-700">MSG</div>
                                <div class="text-[9px] text-red-500 font-bold">-Â¥2,500</div>
                            </div>
                        </button>
                    </div>
                </div>

                <div>
                    <h4 class="text-xs font-black text-blue-400 uppercase mb-3 tracking-widest">ğŸ§ª ä¿å­˜æ–™ãƒ»ãã®ä»–</h4>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="game.addAdditive('sorbic')" class="ingredient-card btn-press border-blue-300 hover:border-blue-400 p-2.5 flex items-center gap-2 text-left">
                            <div class="text-xl bg-blue-100 rounded-full w-8 h-8 flex items-center justify-center shadow-sm">ğŸ§´</div>
                            <div class="leading-tight flex-1">
                                <div class="font-bold text-[11px] text-blue-700">ã‚½ãƒ«ãƒ“ãƒ³é…¸K</div>
                                <div class="text-[9px] text-red-500 font-bold">-Â¥1,600</div>
                            </div>
                        </button>
                        <button onclick="game.addAdditive('benzoate')" class="ingredient-card btn-press border-indigo-300 hover:border-indigo-400 p-2.5 flex items-center gap-2 text-left">
                            <div class="text-xl bg-indigo-100 rounded-full w-8 h-8 flex items-center justify-center shadow-sm">ğŸ’‰</div>
                            <div class="leading-tight flex-1">
                                <div class="font-bold text-[11px] text-indigo-700">å®‰æ¯é¦™é…¸Na</div>
                                <div class="text-[9px] text-red-500 font-bold">-Â¥1,400</div>
                            </div>
                        </button>
                        <button onclick="game.addAdditive('phosphate')" class="ingredient-card btn-press border-teal-300 hover:border-teal-400 p-2.5 flex items-center gap-2 text-left">
                            <div class="text-xl bg-teal-100 rounded-full w-8 h-8 flex items-center justify-center shadow-sm">âš—ï¸</div>
                            <div class="leading-tight flex-1">
                                <div class="font-bold text-[11px] text-teal-700">ãƒªãƒ³é…¸å¡©</div>
                                <div class="text-[9px] text-red-500 font-bold">-Â¥1,300</div>
                            </div>
                        </button>
                        <button onclick="game.addAdditive('nitrite')" class="ingredient-card btn-press border-red-400 hover:border-red-500 p-2.5 flex items-center gap-2 text-left">
                            <div class="text-xl bg-red-100 rounded-full w-8 h-8 flex items-center justify-center shadow-sm">â˜¢ï¸</div>
                            <div class="leading-tight flex-1">
                                <div class="font-bold text-[11px] text-red-700">äºœç¡é…¸Na</div>
                                <div class="text-[9px] text-red-500 font-bold">-Â¥2,200</div>
                            </div>
                        </button>
                        <button onclick="game.addAdditive('transfat')" class="ingredient-card btn-press border-yellow-400 hover:border-yellow-500 p-2.5 flex items-center gap-2 text-left">
                            <div class="text-xl bg-yellow-100 rounded-full w-8 h-8 flex items-center justify-center shadow-sm">ğŸ§ˆ</div>
                            <div class="leading-tight flex-1">
                                <div class="font-bold text-[11px] text-yellow-700">éƒ¨åˆ†æ°´ç´ æ·»åŠ æ²¹è„‚</div>
                                <div class="text-[9px] text-red-500 font-bold">-Â¥1,100</div>
                            </div>
                        </button>
                        <button onclick="game.addAdditive('casein')" class="ingredient-card btn-press border-sky-300 hover:border-sky-400 p-2.5 flex items-center gap-2 text-left">
                            <div class="text-xl bg-sky-100 rounded-full w-8 h-8 flex items-center justify-center shadow-sm">ğŸ¥›</div>
                            <div class="leading-tight flex-1">
                                <div class="font-bold text-[11px] text-sky-700">ã‚«ã‚¼ã‚¤ãƒ³Na</div>
                                <div class="text-[9px] text-red-500 font-bold">-Â¥1,700</div>
                            </div>
                        </button>
                    </div>
                </div>
            </div>

            <div class="p-4 bg-gradient-to-r from-pink-50 to-purple-50 border-t-2 border-pink-200">
                <button onclick="game.sellProduct()" class="btn-press w-full bg-gradient-to-r from-pink-400 via-purple-400 to-blue-400 text-white font-black py-4 rounded-2xl shadow-xl flex items-center justify-center gap-3 hover:shadow-2xl transition-all text-lg">
                    <span>å®Œæˆï¼å‡ºè·ã™ã‚‹</span>
                    <span class="text-2xl">ğŸš€</span>
                </button>
            </div>
        </div>
    </div>

    <div id="resultModal" class="modal-overlay fixed inset-0 z-50 flex items-center justify-center hidden opacity-0 transition-opacity duration-300">
        <div class="bg-white rounded-3xl p-8 max-w-md w-[92%] shadow-2xl transform scale-95 transition-transform duration-300 border-4 border-pink-200" id="modalContent">
            <div class="text-center mb-6">
                <div id="resultEmoji" class="text-7xl mb-3">ğŸ‰</div>
                <h2 id="resultTitle" class="text-3xl font-black text-slate-800 mb-3">å¤§ãƒ’ãƒƒãƒˆï¼</h2>
                <p id="resultDesc" class="text-slate-600 text-sm leading-relaxed">ä¸­æ¯’çš„ãªç¾å‘³ã—ã•ã§ãƒã‚«å£²ã‚Œï¼</p>
            </div>
            
            <div class="bg-gradient-to-br from-pink-50 to-purple-50 rounded-2xl p-5 mb-6 space-y-3 border-2 border-pink-100">
                <div class="flex justify-between items-center border-b-2 border-pink-200 pb-3">
                    <span class="text-sm font-bold text-slate-700">ğŸ’° å£²ä¸Š</span>
                    <span id="resultSales" class="font-black text-xl text-green-600">+ 0</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-sm font-bold text-slate-700">â­ ä¸–é–“ã®è©•ä¾¡</span>
                    <span id="resultRep" class="font-black text-xl text-blue-600">+ 0</span>
                </div>
            </div>

            <button onclick="game.closeModal()" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white font-black py-4 rounded-2xl hover:from-purple-600 hover:to-pink-600 transition-all shadow-lg text-lg">
                æ¬¡ã®é–‹ç™ºã¸ âœ¨
            </button>
        </div>
    </div>

    <script>
        const TRANSLATIONS = {
            ja: {
                money: "è³‡é‡‘",
                reputation: "è©•åˆ¤",
                base_food: "æ··åˆç‰©",
                processing: "(é–‹ç™ºä¸­)",
                flavor: "å‘³ãƒ»ä¸­æ¯’æ€§",
                appearance: "è¦‹ãŸç›®ãƒ»æ˜ ãˆ",
                safety: "å®‰å…¨æ€§ãƒ»å¥åº·",
                cost: "è£½é€ ã‚³ã‚¹ãƒˆ",
                additives_title: "åŸææ–™ & æ·»åŠ ç‰©",
                header_base: "ãƒ™ãƒ¼ã‚¹ç´ æ (è£½é€ ã‚³ã‚¹ãƒˆâ†‘)",
                header_additives: "åŒ–å­¦æ·»åŠ ç‰© (ç ”ç©¶è²»ãŒã‹ã‹ã‚‹)",
                reset: "ãƒªã‚»ãƒƒãƒˆ",
                ship: "å®Œæˆï¼å‡ºè·ã™ã‚‹",
                
                // Ingredients
                ing_water: "æ°´",
                ing_flour: "å°éº¦ç²‰",
                ing_meat: "è‚‰ãƒšãƒ¼ã‚¹ãƒˆ",
                ing_gelatin: "ã‚¼ãƒ©ãƒãƒ³",

                // Products
                prod_empty: "ç©ºã®ãƒœã‚¦ãƒ«",
                prod_water: "ãŸã ã®æ°´",
                prod_juice: "äººå·¥ã‚¸ãƒ¥ãƒ¼ã‚¹",
                prod_dough: "è¬ã®ç·´ã‚Šç‰©",
                prod_snack: "ã‚¹ãƒŠãƒƒã‚¯è“å­",
                prod_meat: "ç”Ÿè‚‰ã®å¡Š",
                prod_ham: "åŠ å·¥ãƒãƒ ",
                prod_jelly: "ã‚¼ãƒªãƒ¼",
                prod_sludge: "è¬ã®ãƒ˜ãƒ‰ãƒ­",

                // Additives
                add_color: "åˆæˆç€è‰²æ–™",
                add_preservative: "ä¿å­˜æ–™",
                add_msg: "åŒ–å­¦èª¿å‘³æ–™",
                add_sweetener: "äººå·¥ç”˜å‘³æ–™",
                
                // Results
                res_recall_title: "å›åé¨’ãï¼",
                res_recall_desc: "ã€Œå¤‰ãªå‘³ãŒã™ã‚‹ã€ã¨ã‚¯ãƒ¬ãƒ¼ãƒ æ®ºåˆ°ã€‚ä¿å¥æ‰€ã®ç«‹ã¡å…¥ã‚Šæ¤œæŸ»ãŒå…¥ã‚Šã¾ã—ãŸã€‚",
                res_hit_title: "æ‚ªé­”çš„ãƒ’ãƒƒãƒˆï¼",
                res_hit_desc: "ä¸­æ¯’çš„ãªç¾å‘³ã—ã•ã§ãƒã‚«å£²ã‚Œã€‚ä¸€éƒ¨ã§ã€Œä½•ãŒå…¥ã£ã¦ã‚‹ã‚“ã ï¼Ÿã€ã¨å™‚ã«ã€‚",
                res_fail_org_title: "é«˜ã™ãã¦å£²ã‚Œãªã„",
                res_fail_org_desc: "ã€Œä½“ã«è‰¯ã„ã®ã¯ã‚ã‹ã‚‹ã‘ã©é«˜ã™ãã‚‹ã€ã¨ä¸»å©¦å±¤ã«ã‚¹ãƒ«ãƒ¼ã•ã‚Œã¾ã—ãŸã€‚",
                res_fail_bad_title: "åœ¨åº«ã®å±±",
                res_fail_bad_desc: "å‘³ãŒè–„ãã€è¦‹ãŸç›®ã‚‚ãƒ‘ãƒƒã¨ã—ãªã„ãŸã‚ãƒ¯ã‚´ãƒ³ã‚»ãƒ¼ãƒ«è¡Œãã§ã™ã€‚",
                res_normal_title: "ãã“ãã“ã®å£²ä¸Š",
                res_normal_desc: "å®šç•ªå•†å“ã¨ã—ã¦ç„¡é›£ã«å£²ã‚Œã¾ã—ãŸã€‚",
                res_trash_title: "ç”£æ¥­å»ƒæ£„ç‰©",
                res_trash_desc: "ã“ã‚Œã¯é£Ÿã¹ç‰©ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã£ãã‚Šå»ƒæ£„ã—ã¾ã—ãŸã€‚",

                res_sales: "å£²ä¸Š",
                res_rating: "ä¸–é–“ã®è©•ä¾¡",
                res_next: "æ¬¡ã®é–‹ç™ºã¸",
                currency: "Â¥"
            },
            en: {
                money: "Funds",
                reputation: "Reputation",
                base_food: "Mixture",
                processing: "(Dev)",
                flavor: "Flavor",
                appearance: "Looks",
                safety: "Safety",
                cost: "Unit Cost",
                additives_title: "Ingredients & Chemicals",
                header_base: "Base (Increases Unit Cost)",
                header_additives: "Additives (Research Cost)",
                reset: "Reset",
                ship: "Ship Product",
                
                ing_water: "Water",
                ing_flour: "Flour",
                ing_meat: "Meat Paste",
                ing_gelatin: "Gelatin",

                prod_empty: "Empty Bowl",
                prod_water: "Water",
                prod_juice: "Artificial Juice",
                prod_dough: "Dough",
                prod_snack: "Snack",
                prod_meat: "Raw Meat",
                prod_ham: "Processed Ham",
                prod_jelly: "Jelly",
                prod_sludge: "Mystery Sludge",

                add_color: "Art. Color",
                add_preservative: "Preservative",
                add_msg: "MSG",
                add_sweetener: "Sweetener",
                
                res_recall_title: "Recall Scandal!",
                res_recall_desc: "Complaints about 'chemical taste'. Health inspectors are knocking.",
                res_hit_title: "Devilishly Good!",
                res_hit_desc: "It's addictive! People are asking 'What's in this?' but keep buying.",
                res_fail_org_title: "Too Expensive",
                res_fail_org_desc: "\"I know it's healthy, but it's too expensive,\" say customers.",
                res_fail_bad_title: "Shelf Warmer",
                res_fail_bad_desc: "Bland taste, boring look. Destined for the clearance bin.",
                res_normal_title: "Decent Sales",
                res_normal_desc: "Sold reasonably well as a standard product.",
                res_trash_title: "Toxic Waste",
                res_trash_desc: "This is not food. You dumped it secretly.",

                res_sales: "Sales",
                res_rating: "Rating",
                res_next: "Next",
                currency: "$"
            },
            fi: {
                money: "Varat",
                reputation: "Maine",
                base_food: "Seos",
                processing: "(Kehitys)",
                flavor: "Maku",
                appearance: "UlkonÃ¤kÃ¶",
                safety: "Turva",
                cost: "Valmistuskulu",
                additives_title: "Ainesosat & Kemikaalit",
                header_base: "Perus (Nostaa kulua)",
                header_additives: "LisÃ¤aineet (Tutkimuskulu)",
                reset: "Nollaa",
                ship: "Toimita",
                
                ing_water: "Vesi",
                ing_flour: "Jauho",
                ing_meat: "Lihatahna",
                ing_gelatin: "Liivate",

                prod_empty: "TyhjÃ¤ kulho",
                prod_water: "Vesi",
                prod_juice: "Keinotekoinen mehu",
                prod_dough: "Taikina",
                prod_snack: "Sipsit",
                prod_meat: "Raaka liha",
                prod_ham: "Kinkku",
                prod_jelly: "HyytelÃ¶",
                prod_sludge: "Mysteeri mÃ¶njÃ¤",

                add_color: "VÃ¤riaine",
                add_preservative: "SÃ¤ilÃ¶ntÃ¤",
                add_msg: "MSG",
                add_sweetener: "Makeutus",
                
                res_recall_title: "Takaisinveto!",
                res_recall_desc: "Valituksia oudosta mausta. Terveystarkastajat iskevÃ¤t.",
                res_hit_title: "Pirullinen hitti!",
                res_hit_desc: "Koukuttavaa! Ihmiset ihmettelevÃ¤t mitÃ¤ tÃ¤ssÃ¤ on, mutta ostavat silti.",
                res_fail_org_title: "Liian kallis",
                res_fail_org_desc: "\"TiedÃ¤n sen olevan terveellistÃ¤, mutta liian kallista\", sanovat asiakkaat.",
                res_fail_bad_title: "HyllynlÃ¤mmittÃ¤jÃ¤",
                res_fail_bad_desc: "Mauton ja tylsÃ¤. PÃ¤Ã¤tyy alennusmyyntiin.",
                res_normal_title: "OK myynti",
                res_normal_desc: "Myi kohtuullisesti.",
                res_trash_title: "OngelmajÃ¤te",
                res_trash_desc: "TÃ¤mÃ¤ ei ole ruokaa. HÃ¤vitit sen salaa.",

                res_sales: "Myynti",
                res_rating: "Arvosana",
                res_next: "Seuraava",
                currency: "â‚¬"
            },
            da: {
                money: "Midler",
                reputation: "OmdÃ¸mme",
                base_food: "Blanding",
                processing: "(Udvikling)",
                flavor: "Smag",
                appearance: "Udseende",
                safety: "Sikkerhed",
                cost: "Enhedspris",
                additives_title: "Ingredienser & Kemikalier",
                header_base: "Basis (Ã˜ger pris)",
                header_additives: "TilsÃ¦tning (Forskningspris)",
                reset: "Nulstil",
                ship: "Send afsted",
                
                ing_water: "Vand",
                ing_flour: "Mel",
                ing_meat: "KÃ¸dpasta",
                ing_gelatin: "Gelatine",

                prod_empty: "Tom skÃ¥l",
                prod_water: "Vand",
                prod_juice: "Kunstig Juice",
                prod_dough: "Dej",
                prod_snack: "Chips",
                prod_meat: "RÃ¥t kÃ¸d",
                prod_ham: "Skinke",
                prod_jelly: "GelÃ©",
                prod_sludge: "Mystisk slam",

                add_color: "Farve",
                add_preservative: "Konservering",
                add_msg: "MSG",
                add_sweetener: "SÃ¸demiddel",
                
                res_recall_title: "Skandale!",
                res_recall_desc: "Klager over kemisk smag. FÃ¸devarestyrelsen er pÃ¥ sagen.",
                res_hit_title: "DjÃ¦velsk hit!",
                res_hit_desc: "Det er vanedannende! Folk spÃ¸rger 'Hvad er der i?', men kÃ¸ber det.",
                res_fail_org_title: "For dyrt",
                res_fail_org_desc: "\"Jeg ved det er sundt, men det er for dyrt,\" siger kunderne.",
                res_fail_bad_title: "Hyldevarmer",
                res_fail_bad_desc: "Kedelig smag, kedeligt look. Ender i tilbudskurven.",
                res_normal_title: "Fint salg",
                res_normal_desc: "Solgte nogenlunde.",
                res_trash_title: "Giftigt affald",
                res_trash_desc: "Dette er ikke mad. Du smed det ud i hemmelighed.",

                res_sales: "Salg",
                res_rating: "BedÃ¸mmelse",
                res_next: "NÃ¦ste",
                currency: "kr."
            }
        };

        class SoundManager {
            constructor() {
                try {
                    this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                    this.masterGain = this.ctx.createGain();
                    this.masterGain.gain.value = 0.25;
                    this.masterGain.connect(this.ctx.destination);
                } catch(e) {
                    this.ctx = null;
                }
            }
            playTone(freq, type, duration, startTime = 0) {
                if (!this.ctx || this.ctx.state === 'suspended') return;
                try {
                    const osc = this.ctx.createOscillator();
                    const gain = this.ctx.createGain();
                    osc.type = type;
                    osc.frequency.setValueAtTime(freq, this.ctx.currentTime + startTime);
                    gain.gain.setValueAtTime(0.4, this.ctx.currentTime + startTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + startTime + duration);
                    osc.connect(gain);
                    gain.connect(this.masterGain);
                    osc.start(this.ctx.currentTime + startTime);
                    osc.stop(this.ctx.currentTime + startTime + duration);
                } catch(e) {}
            }
            playAdd() { this.playTone(900, 'sine', 0.08); this.playTone(700, 'sine', 0.08, 0.04); }
            playAddBase() { this.playTone(250, 'triangle', 0.12); this.playTone(200, 'triangle', 0.15, 0.08); }
            playSuccess() { this.playTone(1400, 'square', 0.08, 0); this.playTone(1800, 'square', 0.35, 0.08); }
            playFail() { this.playTone(180, 'sawtooth', 0.35); this.playTone(120, 'sawtooth', 0.35, 0.15); }
            playWarning() { this.playTone(350, 'sawtooth', 0.18); }
        }

        class Game {
            constructor() {
                this.sound = new SoundManager();
                this.currentLang = 'ja';
                
                this.additives = {
                    hfcs: { flavor: 15, appearance: 5, safety: -12, cost: -8, sugar: 45, researchCost: 1200 },
                    aspartame: { flavor: 25, appearance: 0, safety: -18, cost: -15, sugar: 0, researchCost: 2000 },
                    acesulfame: { flavor: 22, appearance: 0, safety: -15, cost: -12, sugar: 0, researchCost: 1800 },
                    citric: { flavor: 18, appearance: 5, safety: -5, cost: -6, researchCost: 800 },
                    color: { flavor: 0, appearance: 30, safety: -18, cost: -7, researchCost: 1000 },
                    caramel: { flavor: 5, appearance: 25, safety: -10, cost: -6, researchCost: 900 },
                    flavor: { flavor: 28, appearance: 10, safety: -14, cost: -10, researchCost: 1500 },
                    msg: { flavor: 35, appearance: 0, safety: -22, cost: -12, sodium: 800, researchCost: 2500 },
                    sorbic: { flavor: -8, appearance: 3, safety: -12, cost: -14, researchCost: 1600 },
                    benzoate: { flavor: -6, appearance: 2, safety: -10, cost: -12, researchCost: 1400 },
                    phosphate: { flavor: 8, appearance: 12, safety: -16, cost: -10, sodium: 500, researchCost: 1300 },
                    nitrite: { flavor: 5, appearance: 20, safety: -25, cost: -15, researchCost: 2200 },
                    transfat: { flavor: 20, appearance: 15, safety: -30, cost: -18, transFat: 3.5, researchCost: 1100 },
                    casein: { flavor: 12, appearance: 18, safety: -8, cost: -11, sodium: 300, researchCost: 1700 }
                };

                this.baseIngredients = {
                    water: { flavor: 0, appearance: 0, safety: 15, cost: 5, type: 'liquid' },
                    carbonated: { flavor: 5, appearance: 8, safety: 12, cost: 8, type: 'liquid' },
                    flour: { flavor: 8, appearance: 8, safety: 22, cost: 10, type: 'powder' },
                    oil: { flavor: 10, appearance: 10, safety: 18, cost: 12, type: 'fat', transFat: 0.2 },
                    meat: { flavor: 25, appearance: 25, safety: 20, cost: 35, type: 'solid', sodium: 200 },
                    gelatin: { flavor: 0, appearance: 15, safety: 25, cost: 15, type: 'thickener' }
                };

                this.state = {
                    money: 1000000,
                    reputation: 3.0,
                    addedIngredients: [],
                    stats: { flavor: 0, appearance: 0, safety: 100, cost: 0, transFat: 0, sodium: 0, sugar: 0 },
                    currentProductType: 'empty',
                    emoji: 'ğŸ¥£'
                };

                this.init();
            }

            init() { this.resetFood(); }

            setLanguage(lang) {
                this.currentLang = lang;
                this.updateUI();
            }

            resetFood() {
                if (this.state.addedIngredients && this.state.addedIngredients.length > 0) this.sound.playWarning();
                
                this.state.addedIngredients = [];
                this.state.stats = { flavor: 0, appearance: 0, safety: 100, cost: 0, transFat: 0, sodium: 0, sugar: 0 };
                this.state.currentProductType = 'empty';
                this.state.emoji = 'ğŸ¥£';
                
                const emoji = document.getElementById('foodEmoji');
                emoji.className = "text-9xl mb-4 floating food-display cursor-pointer transition-transform"; 
                
                this.updateUI();
            }

            addIngredient(key) {
                const ing = this.baseIngredients[key];
                if (!ing) return;

                this.state.addedIngredients.push(key);
                
                this.state.stats.flavor += ing.flavor;
                this.state.stats.appearance += ing.appearance;
                this.state.stats.safety = (this.state.stats.safety + ing.safety) / (this.state.addedIngredients.length === 1 ? 1 : 1.08);
                this.state.stats.cost += ing.cost;
                this.state.stats.transFat += ing.transFat || 0;
                this.state.stats.sodium += ing.sodium || 0;
                
                this.state.money -= 100; 

                this.sound.playAddBase();
                this.showFloatingCost("- Â¥100");
                this.updateProductIdentity();
                this.updateUI();
            }

            addAdditive(key) {
                const add = this.additives[key];
                if (!add) return;
                
                if (this.state.money < add.researchCost) {
                    this.sound.playWarning();
                    alert(this.currentLang === 'ja' ? "è³‡é‡‘ä¸è¶³ã§ã™" : "Not enough funds");
                    return;
                }

                this.state.addedIngredients.push(key);
                this.state.money -= add.researchCost;

                this.state.stats.flavor += add.flavor;
                this.state.stats.appearance += add.appearance;
                this.state.stats.safety += add.safety;
                this.state.stats.cost += add.cost;
                this.state.stats.transFat += add.transFat || 0;
                this.state.stats.sodium += add.sodium || 0;
                this.state.stats.sugar += add.sugar || 0;

                this.sound.playAdd();
                this.showFloatingCost(`- Â¥${add.researchCost.toLocaleString()}`);
                this.triggerVisualEffect();
                this.updateProductIdentity();
                this.updateUI();
            }

            showFloatingCost(text) {
                const container = document.getElementById('floatingCostContainer');
                const el = document.createElement('div');
                el.className = 'cost-text text-red-500 text-xl absolute whitespace-nowrap';
                el.innerText = text;
                el.style.left = (Math.random() * 60 - 30) + 'px';
                el.style.top = (Math.random() * 60 - 30) + 'px';
                container.appendChild(el);
                setTimeout(() => el.remove(), 1200);
            }

            updateProductIdentity() {
                const ings = this.state.addedIngredients;
                const has = (k) => ings.includes(k);
                
                let type = 'sludge';
                let emoji = 'ğŸ§ª';
                let name = 'è¬ã®ãƒ˜ãƒ‰ãƒ­';

                if (ings.length === 0) {
                    type = 'empty';
                    emoji = 'ğŸ¥£';
                    name = 'ç©ºã®ãƒœã‚¦ãƒ«';
                } else if (ings.every(i => ['water'].includes(i))) {
                    type = 'water';
                    emoji = 'ğŸ’§';
                    name = 'ãŸã ã®æ°´';
                } else if (has('carbonated')) {
                    if ((has('hfcs') || has('aspartame')) && (has('citric') || has('flavor'))) {
                        if (has('flavor') && this.state.stats.flavor > 50) {
                            type = 'energy';
                            emoji = 'âš¡';
                            name = 'ã‚¨ãƒŠã‚¸ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯';
                        } else {
                            type = 'soda';
                            emoji = 'ğŸ¥¤';
                            name = 'ç‚­é…¸é£²æ–™';
                        }
                    } else if (has('color') || has('citric')) {
                        type = 'juice';
                        emoji = 'ğŸ§ƒ';
                        name = 'äººå·¥ã‚¸ãƒ¥ãƒ¼ã‚¹';
                    }
                } else if (has('water') && (has('hfcs') || has('aspartame')) && (has('color') || has('citric'))) {
                    type = 'juice';
                    emoji = 'ğŸ§ƒ';
                    name = 'äººå·¥ã‚¸ãƒ¥ãƒ¼ã‚¹';
                } else if (has('meat')) {
                    if ((has('nitrite') || has('phosphate')) && (has('msg') || has('sorbic'))) {
                        type = 'sausage';
                        emoji = 'ğŸŒ­';
                        name = 'ã‚½ãƒ¼ã‚»ãƒ¼ã‚¸';
                    } else if (has('sorbic') || has('msg')) {
                        type = 'ham';
                        emoji = 'ğŸ–';
                        name = 'åŠ å·¥ãƒãƒ ';
                    } else {
                        type = 'meat';
                        emoji = 'ğŸ¥©';
                        name = 'ç”Ÿè‚‰ã®å¡Š';
                    }
                } else if (has('flour')) {
                    if ((has('transfat') || has('oil')) && (has('msg') || has('flavor')) && this.state.stats.flavor > 40) {
                        type = 'snack';
                        emoji = 'ğŸŸ';
                        name = 'ã‚¹ãƒŠãƒƒã‚¯è“å­';
                    } else {
                        type = 'dough';
                        emoji = 'ğŸ';
                        name = 'è¬ã®ç·´ã‚Šç‰©';
                    }
                } else if (has('gelatin')) {
                    if ((has('hfcs') || has('aspartame')) && has('color')) {
                        type = 'jelly';
                        emoji = 'ğŸ®';
                        name = 'ã‚¼ãƒªãƒ¼';
                    } else if (has('hfcs') && has('flavor')) {
                        type = 'candy';
                        emoji = 'ğŸ¬';
                        name = 'ã‚­ãƒ£ãƒ³ãƒ‡ã‚£ãƒ¼';
                    }
                }

                if (ings.length > 7) {
                    type = 'sludge';
                    emoji = 'ğŸ¤¢';
                    name = 'è¬ã®ãƒ˜ãƒ‰ãƒ­';
                }

                this.state.currentProductType = type;
                this.state.emoji = emoji;
                this.state.productName = name;

                this.state.stats.flavor = Math.max(0, Math.min(100, this.state.stats.flavor));
                this.state.stats.appearance = Math.max(0, Math.min(100, this.state.stats.appearance));
                this.state.stats.safety = Math.max(0, Math.min(100, this.state.stats.safety));
                this.state.stats.cost = Math.max(0, Math.min(100, this.state.stats.cost));
            }

            triggerVisualEffect() {
                const emoji = document.getElementById('foodEmoji');
                emoji.classList.remove('pop-anim');
                void emoji.offsetWidth;
                emoji.classList.add('pop-anim');
                
                emoji.className = "text-9xl mb-4 floating food-display cursor-pointer transition-transform pop-anim";
                if (this.state.stats.appearance > 75) emoji.classList.add('tasty-glow');
                if (this.state.stats.safety < 35) emoji.classList.add('toxic-glow');
                if (this.state.stats.transFat > 2 || this.state.stats.sodium > 1000) emoji.classList.add('warning-glow');
            }

            updateWarningBadges() {
                const container = document.getElementById('warningBadges');
                container.innerHTML = '';
                
                if (this.state.stats.transFat > 1) {
                    const badge = document.createElement('span');
                    badge.className = 'warning-badge';
                    badge.textContent = 'âš ï¸ ãƒˆãƒ©ãƒ³ã‚¹è„‚è‚ªé…¸';
                    container.appendChild(badge);
                }
                if (this.state.stats.sodium > 800) {
                    const badge = document.createElement('span');
                    badge.className = 'warning-badge';
                    badge.textContent = 'âš ï¸ é«˜å¡©åˆ†';
                    container.appendChild(badge);
                }
                if (this.state.stats.sugar > 30) {
                    const badge = document.createElement('span');
                    badge.className = 'warning-badge';
                    badge.textContent = 'âš ï¸ é«˜ç³–è³ª';
                    container.appendChild(badge);
                }
                const additiveCount = this.state.addedIngredients.filter(k => this.additives[k]).length;
                if (additiveCount > 5) {
                    const badge = document.createElement('span');
                    badge.className = 'warning-badge';
                    badge.textContent = 'âš ï¸ æ·»åŠ ç‰©å¤šæ•°';
                    container.appendChild(badge);
                }
            }

            updateUI() {
                const s = this.state.stats;

                document.getElementById('moneyDisplay').textContent = `Â¥ ${this.state.money.toLocaleString()}`;
                document.getElementById('reputationDisplay').textContent = `â˜… ${this.state.reputation.toFixed(1)}`;
                
                document.getElementById('foodName').textContent = this.state.productName || 'ç©ºã®ãƒœã‚¦ãƒ«';
                document.getElementById('foodEmoji').textContent = this.state.emoji;

                this.setBar('Flavor', s.flavor);
                this.setBar('Appearance', s.appearance);
                this.setBar('Safety', s.safety, true);
                this.setBar('Cost', s.cost, false, true);

                document.getElementById('valTransFat').textContent = s.transFat.toFixed(1) + 'g';
                document.getElementById('valSodium').textContent = Math.floor(s.sodium) + 'mg';
                document.getElementById('valSugar').textContent = Math.floor(s.sugar) + 'g';

                this.updateWarningBadges();
            }

            setBar(type, value, isSafety = false, isCost = false) {
                const bar = document.getElementById(`bar${type}`);
                const valText = document.getElementById(`val${type}`);
                bar.style.width = `${value}%`;
                valText.textContent = Math.floor(value);

                if (isSafety) {
                    if (value < 30) {
                        bar.className = `stat-bar-fill h-full bg-gradient-to-r from-red-400 to-red-600`;
                    } else if (value < 60) {
                        bar.className = `stat-bar-fill h-full bg-gradient-to-r from-yellow-300 to-yellow-500`;
                    } else {
                        bar.className = `stat-bar-fill h-full bg-gradient-to-r from-green-300 to-green-500`;
                    }
                } else if (isCost) {
                    if (value > 60) {
                        bar.className = `stat-bar-fill h-full bg-gradient-to-r from-red-400 to-red-600`;
                    } else if (value > 30) {
                        bar.className = `stat-bar-fill h-full bg-gradient-to-r from-blue-300 to-blue-500`;
                    } else {
                        bar.className = `stat-bar-fill h-full bg-gradient-to-r from-cyan-300 to-cyan-500`;
                    }
                }
            }

            sellProduct() {
                const s = this.state.stats;
                const type = this.state.currentProductType;
                
                if (this.state.addedIngredients.length === 0) return;

                if (s.transFat > 3 && this.state.addedIngredients.filter(k => this.additives[k]).length > 5) {
                    this.showModal('â˜¢ï¸ å±é™ºã™ãã¦è²©å£²ä¸­æ­¢', 'ãƒˆãƒ©ãƒ³ã‚¹è„‚è‚ªé…¸ã¨æ·»åŠ ç‰©ã¾ã¿ã‚Œã§ã€ç¤¾å†…å¯©æŸ»ã§è²©å£²ä¸­æ­¢ã«ã€‚é–‹ç™ºè²»ãŒç„¡é§„ã«ãªã‚Šã¾ã—ãŸã€‚', -100000, -0.5, 'â˜¢ï¸');
                    this.sound.playFail();
                    return;
                }

                if (type === 'sludge' || type === 'empty' || type === 'meat' || type === 'dough') {
                    this.showModal('â˜¢ï¸ ç”£æ¥­å»ƒæ£„ç‰©', 'ã“ã‚Œã¯é£Ÿã¹ç‰©ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã£ãã‚Šå»ƒæ£„ã—ã¾ã—ãŸã€‚å»ƒæ£„ã‚³ã‚¹ãƒˆãŒç—›ã„...', -60000, -0.3, 'ğŸ—‘ï¸');
                    this.sound.playFail();
                    return;
                }

                let baseSales = (s.flavor + s.appearance) * (125 - s.cost) * 18;
                
                let reputationChange = 0;
                let title = "ğŸ‘ ãã“ãã“ã®å£²ä¸Š";
                let desc = "å®šç•ªå•†å“ã¨ã—ã¦ç„¡é›£ã«å£²ã‚Œã¾ã—ãŸã€‚åœ°å‘³ã§ã™ãŒå®‰å®šåç›Šã§ã™ã€‚";
                let emoji = "ğŸ›’";

                if (s.safety < 25) {
                    baseSales = -1200000;
                    reputationChange = -2.0;
                    title = "ğŸš¨ å›åé¨’ãï¼";
                    desc = "ã€Œå¤‰ãªå‘³ãŒã™ã‚‹ã€ã€Œæ°—åˆ†ãŒæ‚ªããªã£ãŸã€ã¨ã‚¯ãƒ¬ãƒ¼ãƒ æ®ºåˆ°ã€‚ä¿å¥æ‰€ã®ç«‹ã¡å…¥ã‚Šæ¤œæŸ»ãŒå…¥ã‚Šã€å…¨å“å›åã¨ãªã‚Šã¾ã—ãŸã€‚";
                    emoji = "ğŸš‘";
                    this.sound.playFail();
                } else if (s.flavor > 85 && s.appearance > 75 && s.cost < 25) {
                    baseSales *= 3.2;
                    reputationChange = -0.3;
                    title = "ğŸ˜ˆ æ‚ªé­”çš„ãƒ’ãƒƒãƒˆï¼";
                    desc = "ä¸­æ¯’çš„ãªç¾å‘³ã—ã•ã§ãƒã‚«å£²ã‚Œï¼ä¸€éƒ¨ã§ã€Œä½•ãŒå…¥ã£ã¦ã‚‹ã‚“ã ï¼Ÿã€ã¨é¨’ãŒã‚Œã¦ã„ã¾ã™ãŒã€å£²ã‚Œã‚Œã°æ­£ç¾©ã§ã™ã€‚";
                    emoji = "ğŸ’°";
                    this.sound.playSuccess();
                } else if (s.safety > 92 && s.cost > 75) {
                    baseSales *= 0.35;
                    reputationChange = +0.5;
                    title = "ğŸ’¸ é«˜ã™ãã¦å£²ã‚Œãªã„";
                    desc = "ã€Œä½“ã«è‰¯ã„ã®ã¯ã‚ã‹ã‚‹ã‘ã©é«˜ã™ãã‚‹ã€ã¨ä¸»å©¦å±¤ã«ã‚¹ãƒ«ãƒ¼ã•ã‚Œã¾ã—ãŸã€‚ã‚ªãƒ¼ã‚¬ãƒ‹ãƒƒã‚¯å¿—å‘ã¯é›£ã—ã„...";
                    emoji = "ğŸƒ";
                    this.sound.playWarning();
                } else if (s.flavor < 25 && s.appearance < 25) {
                    baseSales = 8000;
                    reputationChange = -0.15;
                    title = "ğŸ“¦ åœ¨åº«ã®å±±";
                    desc = "å‘³ãŒè–„ãã€è¦‹ãŸç›®ã‚‚ãƒ‘ãƒƒã¨ã—ãªã„ãŸã‚ãƒ¯ã‚´ãƒ³ã‚»ãƒ¼ãƒ«è¡Œãã€‚ã»ã¼åŸä¾¡å‰²ã‚Œã§ã™ã€‚";
                    emoji = "ğŸ“‰";
                    this.sound.playWarning();
                } else {
                    reputationChange = 0.12;
                    this.sound.playSuccess();
                }

                this.state.money += baseSales;
                this.state.reputation += reputationChange;
                this.state.reputation = Math.min(5.0, Math.max(0.0, this.state.reputation));

                this.showModal(title, desc, baseSales, reputationChange, emoji);
            }

            showModal(title, desc, sales, rep, emoji) {
                const modal = document.getElementById('resultModal');
                const content = document.getElementById('modalContent');
                
                document.getElementById('resultEmoji').textContent = emoji;
                document.getElementById('resultTitle').textContent = title;
                document.getElementById('resultDesc').textContent = desc;
                
                const salesElem = document.getElementById('resultSales');
                salesElem.textContent = (sales > 0 ? "+ " : "") + `Â¥ ${Math.floor(sales).toLocaleString()}`;
                salesElem.className = sales > 0 ? "font-black text-xl text-green-600" : "font-black text-xl text-red-600";

                const repElem = document.getElementById('resultRep');
                repElem.textContent = (rep > 0 ? "+ " : "") + rep.toFixed(1);
                repElem.className = rep >= 0 ? "font-black text-xl text-blue-600" : "font-black text-xl text-red-600";

                modal.classList.remove('hidden');
                setTimeout(() => {
                    modal.classList.remove('opacity-0');
                    content.classList.remove('scale-95');
                    content.classList.add('scale-100');
                }, 10);
            }

            closeModal() {
                const modal = document.getElementById('resultModal');
                const content = document.getElementById('modalContent');
                
                modal.classList.add('opacity-0');
                content.classList.remove('scale-100');
                content.classList.add('scale-95');
                
                setTimeout(() => {
                    modal.classList.add('hidden');
                    this.resetFood();
                }, 300);
            }
        }

        const game = new Game();
    </script>
</body>
</html>