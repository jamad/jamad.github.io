<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suomi Case Map</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --card-width: 190px;
            --box-size: 450px;
            --ani-play-state: running;
            --ani-delay: 0s;
        }

        body {
            background-color: #020617; color: #f8fafc;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            margin: 0; height: 100vh; overflow: hidden;
        }

        .main-container { display: grid; grid-template-columns: 1fr 350px; height: 100vh; }
        .stage {
            position: relative; display: flex; align-items: center; justify-content: center;
            background: radial-gradient(circle at center, #0f172a 0%, #020617 100%);
            overflow: hidden;
        }

        .target-box {
            position: absolute; width: var(--box-size); height: var(--box-size);
            border: 3px dashed rgba(99, 102, 241, 0.2); border-radius: 60px;
            background: rgba(30, 41, 59, 0.1); z-index: 1;
        }

        /* ÂÖ®„Ç´„Éº„ÉâÁµ±‰∏Ä„Çπ„Çø„Ç§„É´ */
        .case-card {
            position: absolute;
            width: var(--card-width);
            padding: 10px;
            background-color: #0f172a;
            border-radius: 16px;
            border: 1px solid rgba(99, 102, 241, 0.4);
            text-align: center;
            z-index: 20;
            box-shadow: 0 10px 30px rgba(0,0,0,0.7);
            animation-play-state: var(--ani-play-state) !important;
            animation-delay: var(--ani-delay) !important;
            animation-fill-mode: both !important;
        }

        /* SG=PL„ÅßÂΩ¢„ÅåÂ§â„Çè„Çâ„Å™„ÅÑ„Ç´„Éº„Éâ */
        .case-card.sg-pl-same {
            border: 1px solid rgba(99, 102, 241, 0.15);
            opacity: 0.35;
        }

        .case-name { font-size: 9px; font-weight: 900; text-transform: uppercase; margin-bottom: 2px; }
        .case-word {
            font-size: 16px; font-weight: 800; color: white; line-height: 1.2;
            display: flex; align-items: center; justify-content: center; gap: 6px;
        }
        .case-desc { font-size: 10px; color: #94a3b8; margin-top: 2px; }

        .strong-grade { color: #7dd3fc; }
        .weak-grade   { color: #fdba74; }
        .suffix       { color: #64748b; font-weight: 400; font-size: 0.9em; }
        .tts-icon     { opacity: 0.4; font-size: 0.9em; cursor: pointer; transition: opacity 0.2s; }
        .tts-icon:hover { opacity: 1; color: #6366f1; }

        /* 1. ÂÜÖÊ†ºÁ≥ª */
        .pos-inessive { top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 21; }
        .pos-illative { animation: ill-move 6s infinite linear; }
        @keyframes ill-move {
            0%, 40%   { left: 5%;  top: 50%; transform: translateY(-50%);     opacity: 0.5; }
            70%, 100% { left: 40%; top: 50%; transform: translate(-50%, -50%); opacity: 1;   }
        }
        .pos-elative { animation: ela-move 6s infinite linear; }
        @keyframes ela-move {
            0%, 40%   { left: 60%; top: 50%; transform: translate(-50%, -50%); opacity: 1;   }
            70%, 100% { left: 95%; top: 50%; transform: translate(-50%, -50%); opacity: 0.5; }
        }

        /* 2. Êé•Ê†ºÁ≥ª */
        .pos-adessive { top: calc(50% - 225px); left: 50%; transform: translate(-50%, -110%); }
        .pos-allative { animation: all-move 6s infinite linear; }
        @keyframes all-move {
            0%, 40%   { top: 15%; left: 25%; transform: translate(-50%, -110%); opacity: 0.5; }
            70%, 100% { top: calc(50% - 225px); left: calc(50% - 195px); transform: translate(-50%, -110%); opacity: 1; }
        }
        .pos-ablative { animation: abl-move 6s infinite linear; }
        @keyframes abl-move {
            0%, 40%   { top: calc(50% - 225px); left: calc(50% + 195px); transform: translate(-50%, -110%); opacity: 1; }
            70%, 100% { top: 15%; left: 75%; transform: translate(-50%, -110%); opacity: 0.5; }
        }

        /* Âõ∫ÂÆö‰ΩçÁΩÆ */
        .pos-nominative  { top: calc(50% + 290px); left: 50%;  transform: translateX(-50%); background: rgba(99, 102, 241, 0.15) !important; }
        .pos-essive      { top: calc(50% + 290px); left: 25%;  transform: translateX(-50%); }
        .pos-translative { top: calc(50% + 290px); left: 82%;  transform: translateX(-50%); }
        .pos-partitive   { top: calc(50% + 365px); left: 30%;  transform: translateX(-50%); }
        .pos-akkusatiivi { top: 35%; right: 5%; }

        /* Genetiivi: SG=Âè≥‰∏ã(Âº±Â§âÂåñÂÅ¥) / PL=Â∑¶‰∏ã(Âº∑Â§âÂåñÂÅ¥) */
        .pos-genitive.num-sg { top: calc(50% + 140px); left: calc(50% + 140px); transform: translateX(-50%); transition: left 0.4s ease; }
        .pos-genitive.num-pl { top: calc(50% + 140px); left: calc(50% - 140px); transform: translateX(-50%); transition: left 0.4s ease; }

        /* Âë®Ëæ∫Ê†º: Abessiivi=Âè≥‰∏ã(Âº±Â§âÂåñgi) / Komitatiivi=Â∑¶‰∏ã(Âº∑Â§âÂåñnk) */
        .pos-abessiivi    { bottom: 5%; right: 5%; }
        .pos-komitatiivi  { bottom: 5%; left: 5%;  }
        .pos-instruktiivi { top: 15%;  left: 5%;  }

        /* „Ç¨„Ç§„Éâ„É©„Ç§„É≥ */
        .guide-path {
            position: absolute;
            border-top: 2px dotted rgba(255, 255, 255, 0.1);
            pointer-events: none; z-index: 5;
        }
        .path-illative { top: 50%; left: 5%;  width: 35%; }
        .path-elative  { top: 50%; left: 60%; width: 35%; }
        .path-allative { top: calc(15% - 25px); left: 25%; width: 15vw; transform: rotate(18deg);  transform-origin: left center; }
        .path-ablative { top: calc(15% - 25px); left: 75%; width: 15vw; transform: rotate(162deg); transform-origin: left center; }

        .emoji-container {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            display: grid; gap: 20px; z-index: 5; opacity: 0.08; pointer-events: none;
        }
        .emoji-container.sg { grid-template-columns: 1fr;     font-size: 20rem; }
        .emoji-container.pl { grid-template-columns: 1fr 1fr; font-size: 10rem; }

        .stage-toggle {
            position: absolute; top: calc(50% + 375px); left: 50%; transform: translateX(-50%);
            display: flex; background: #1e293b; padding: 3px; border-radius: 10px; z-index: 100; border: 1px solid #334155;
        }
        .toggle-btn { padding: 5px 15px; font-size: 11px; font-weight: 800; border-radius: 7px; cursor: pointer; color: #94a3b8; }
        .toggle-btn.active { background: #6366f1; color: white; }

        .sidebar { background: #0f172a; border-left: 1px solid #1e293b; padding: 20px; overflow-y: auto; }
        .word-btn {
            width: 100%; padding: 10px; margin-bottom: 8px; background: #1e293b;
            border: 2px solid transparent; border-radius: 12px;
            display: flex; align-items: center; gap: 10px; cursor: pointer;
        }
        .word-btn.active { border-color: #6366f1; background: #1e1b4b; }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="stage">
            <div class="target-box"></div>
            <div class="w-full h-full absolute pointer-events-none">
                <div class="guide-path path-illative"></div>
                <div class="guide-path path-elative"></div>
                <div class="guide-path path-allative"></div>
                <div class="guide-path path-ablative"></div>
            </div>
            <div id="emoji-container" class="emoji-container sg"></div>
            <div class="stage-toggle">
                <div id="sg-btn" class="toggle-btn active" onclick="setNumber('sg')">Yksikk√∂ (SG)</div>
                <div id="pl-btn" class="toggle-btn"        onclick="setNumber('pl')">Monikko (PL)</div>
            </div>
            <div id="case-layer" class="w-full h-full relative"></div>
        </div>

        <div class="sidebar">
            <div class="mb-6">
                <h1 class="text-xl font-black text-white leading-tight">Suomi Case Map</h1>
                <span class="text-[10px] font-bold text-indigo-400 uppercase tracking-[0.2em]">v16 Fixed</span>
            </div>
            <div id="word-list" class="max-h-[55vh] overflow-y-auto mb-6 pr-1"></div>
            <div class="p-3 bg-slate-800/50 rounded-xl">
                <label class="text-[10px] font-bold text-slate-400 uppercase mb-2 block">Animation Control</label>
                <div class="flex bg-slate-900 p-1 rounded-lg gap-1">
                    <div id="play-btn-tab"  class="toggle-btn flex-1 text-center active" onclick="togglePlay(false)">Play</div>
                    <div id="pause-btn-tab" class="toggle-btn flex-1 text-center"        onclick="togglePlay(true)">Pause</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const CASE_CONFIGS = [
            { id: 'Nominatiivi',  name: '‰∏ªÊ†º (Nominatiivi)',  desc: '„Äú„ÅØ',       class: 'pos-nominative',  color: '#6366f1' },
            { id: 'Genetiivi',    name: 'Â±ûÊ†º (Genetiivi)',    desc: '„Äú„ÅÆ',       class: 'pos-genitive',    color: '#818cf8' },
            { id: 'Akkusatiivi',  name: 'ÂØæÊ†º (Akkusatiivi)',  desc: '„Äú„Çí',       class: 'pos-akkusatiivi', color: '#a5b4fc' },
            { id: 'Partitiivi',   name: 'ÂàÜÊ†º (Partitiivi)',   desc: '„Äú„Çí(‰∏ÄÈÉ®)', class: 'pos-partitive',   color: '#94a3b8' },
            { id: 'Inessiivi',    name: 'ÂÜÖÊ†º (Inessiivi)',    desc: '‰∏≠„Åß',       class: 'pos-inessive',    color: '#f43f5e' },
            { id: 'Illatiivi',    name: 'ÂÖ•Ê†º (Illatiivi)',    desc: '‰∏≠„Å∏',       class: 'pos-illative',    color: '#fb7185' },
            { id: 'Elatiivi',     name: 'Âá∫Ê†º (Elatiivi)',     desc: '‰∏≠„Åã„Çâ',     class: 'pos-elative',     color: '#fb7185' },
            { id: 'Adessiivi',    name: 'Êé•Ê†º (Adessiivi)',    desc: '‰∏ä„Åß/„Åß',    class: 'pos-adessive',    color: '#10b981' },
            { id: 'Allatiivi',    name: 'ÂêëÊ†º (Allatiivi)',    desc: '‰∏ä„Å∏/„Å´',    class: 'pos-allative',    color: '#34d399' },
            { id: 'Ablatiivi',    name: 'Â•™Ê†º (Ablatiivi)',    desc: '‰∏ä„Åã„Çâ',     class: 'pos-ablative',    color: '#34d399' },
            { id: 'Essiivi',      name: 'ÂÖ∑Ê†º (Essiivi)',      desc: '„Å®„Åó„Å¶',     class: 'pos-essive',      color: '#fbbf24' },
            { id: 'Translatiivi', name: 'Â§âÊ†º (Translatiivi)', desc: '„Å´„Å™„Çã',     class: 'pos-translative', color: '#f59e0b' },
            { id: 'Abessiivi',    name: 'Âá¶Ê†º (Abessiivi)',    desc: '„Å™„Åó„Åß',     class: 'pos-abessiivi',   color: '#94a3b8' },
            { id: 'Komitatiivi',  name: 'ÂÖ±Ê†º (Komitatiivi)',  desc: '„Å®ÂÖ±„Å´',     class: 'pos-komitatiivi', color: '#94a3b8' },
            { id: 'Instruktiivi', name: 'ÊßòÊ†º (Instruktiivi)', desc: '„Å´„Çà„Çä',     class: 'pos-instruktiivi',color: '#94a3b8' }
        ];

        const WORDS = [
            { id: 'leipa', base: 'leip√§', meaning: '„Éë„É≥ (p‚Üív)', emoji: 'üçû', kpt: { s: 'p', w: 'v' },
              sg: { Nominatiivi: 'leip√§', Genetiivi: 'leiv√§n', Akkusatiivi: 'leiv√§n', Partitiivi: 'leip√§√§', Inessiivi: 'leiv√§ss√§', Elatiivi: 'leiv√§st√§', Illatiivi: 'leip√§√§n', Adessiivi: 'leiv√§ll√§', Ablatiivi: 'leiv√§lt√§', Allatiivi: 'leiv√§lle', Essiivi: 'leip√§n√§', Translatiivi: 'leiv√§ksi', Abessiivi: 'leiv√§tt√§', Komitatiivi: 'leipineen', Instruktiivi: 'leivin' },
              pl: { Nominatiivi: 'leiv√§t', Genetiivi: 'leipien', Akkusatiivi: 'leiv√§t', Partitiivi: 'leipi√§', Inessiivi: 'leiviss√§', Elatiivi: 'leivist√§', Illatiivi: 'leipiin', Adessiivi: 'leivill√§', Ablatiivi: 'leivilt√§', Allatiivi: 'leiville', Essiivi: 'leipin√§', Translatiivi: 'leiviksi', Abessiivi: 'leivitt√§', Komitatiivi: 'leipineen', Instruktiivi: 'leivin' }
            },
            { id: 'hattu', base: 'hattu', meaning: 'Â∏ΩÂ≠ê (tt‚Üít)', emoji: 'üëí', kpt: { s: 'tt', w: 't' },
              sg: { Nominatiivi: 'hattu', Genetiivi: 'hatun', Akkusatiivi: 'hatun', Partitiivi: 'hattua', Inessiivi: 'hatussa', Elatiivi: 'hatusta', Illatiivi: 'hattuun', Adessiivi: 'hatulla', Ablatiivi: 'hatulta', Allatiivi: 'hatulle', Essiivi: 'hattuna', Translatiivi: 'hatuksi', Abessiivi: 'hatutta', Komitatiivi: 'hattuineen', Instruktiivi: 'hatuin' },
              pl: { Nominatiivi: 'hatut', Genetiivi: 'hattujen', Akkusatiivi: 'hatut', Partitiivi: 'hattuja', Inessiivi: 'hatuissa', Elatiivi: 'hatuista', Illatiivi: 'hattuihin', Adessiivi: 'hatuilla', Ablatiivi: 'hatuilta', Allatiivi: 'hatuille', Essiivi: 'hattuina', Translatiivi: 'hatuiksi', Abessiivi: 'hatuitta', Komitatiivi: 'hattuineen', Instruktiivi: 'hatuin' }
            },
            { id: 'kukka', base: 'kukka', meaning: 'Ëä± (kk‚Üík)', emoji: 'üå∏', kpt: { s: 'kk', w: 'k' },
              sg: { Nominatiivi: 'kukka', Genetiivi: 'kukan', Akkusatiivi: 'kukan', Partitiivi: 'kukkaa', Inessiivi: 'kukassa', Elatiivi: 'kukasta', Illatiivi: 'kukkaan', Adessiivi: 'kukalla', Ablatiivi: 'kukalta', Allatiivi: 'kukalle', Essiivi: 'kukkana', Translatiivi: 'kukaksi', Abessiivi: 'kukatta', Komitatiivi: 'kukkineen', Instruktiivi: 'kukkia' },
              pl: { Nominatiivi: 'kukat', Genetiivi: 'kukkien', Akkusatiivi: 'kukat', Partitiivi: 'kukkia', Inessiivi: 'kukissa', Elatiivi: 'kukista', Illatiivi: 'kukkiin', Adessiivi: 'kukilla', Ablatiivi: 'kukilta', Allatiivi: 'kukille', Essiivi: 'kukkina', Translatiivi: 'kukiksi', Abessiivi: 'kukitta', Komitatiivi: 'kukkineen', Instruktiivi: 'kukkia' }
            },
            { id: 'kaupunki', base: 'kaupunki', meaning: 'Áî∫ (nk‚Üíng)', emoji: 'üèôÔ∏è', kpt: { s: 'nk', w: 'ng' },
              sg: { Nominatiivi: 'kaupunki', Genetiivi: 'kaupungin', Akkusatiivi: 'kaupungin', Partitiivi: 'kaupunkia', Inessiivi: 'kaupungissa', Elatiivi: 'kaupungista', Illatiivi: 'kaupunkiin', Adessiivi: 'kaupungilla', Ablatiivi: 'kaupungilta', Allatiivi: 'kaupungille', Essiivi: 'kaupunkina', Translatiivi: 'kaupungiksi', Abessiivi: 'kaupungitta', Komitatiivi: 'kaupunkeineen', Instruktiivi: 'kaupungein' },
              pl: { Nominatiivi: 'kaupungit', Genetiivi: 'kaupunkien', Akkusatiivi: 'kaupungit', Partitiivi: 'kaupunkeja', Inessiivi: 'kaupungeissa', Elatiivi: 'kaupungeista', Illatiivi: 'kaupunkeihin', Adessiivi: 'kaupungeilla', Ablatiivi: 'kaupungeilta', Allatiivi: 'kaupungeille', Essiivi: 'kaupunkeina', Translatiivi: 'kaupungeiksi', Abessiivi: 'kaupungeitta', Komitatiivi: 'kaupunkeineen', Instruktiivi: 'kaupungein' }
            },
            { id: 'talo', base: 'talo', meaning: 'ÂÆ∂', emoji: 'üè†',
              sg: { Nominatiivi: 'talo', Genetiivi: 'talon', Akkusatiivi: 'talon', Partitiivi: 'taloa', Inessiivi: 'talossa', Elatiivi: 'talosta', Illatiivi: 'taloon', Adessiivi: 'talolla', Ablatiivi: 'talolta', Allatiivi: 'talolle', Essiivi: 'talona', Translatiivi: 'taloksi', Abessiivi: 'talotta', Komitatiivi: 'taloineen', Instruktiivi: 'taloin' },
              pl: { Nominatiivi: 'talot', Genetiivi: 'talojen', Akkusatiivi: 'talot', Partitiivi: 'taloja', Inessiivi: 'taloissa', Elatiivi: 'taloista', Illatiivi: 'taloihin', Adessiivi: 'taloilla', Ablatiivi: 'taloilta', Allatiivi: 'taloille', Essiivi: 'taloina', Translatiivi: 'taloiksi', Abessiivi: 'taloitta', Komitatiivi: 'taloineen', Instruktiivi: 'taloin' }
            },
            { id: 'koti', base: 'koti', meaning: 'Ëá™ÂÆÖ (t‚Üíd)', emoji: 'üè°', kpt: { s: 't', w: 'd' },
              sg: { Nominatiivi: 'koti', Genetiivi: 'kodin', Akkusatiivi: 'kodin', Partitiivi: 'kotia', Inessiivi: 'kodissa', Elatiivi: 'kodista', Illatiivi: 'kotiin', Adessiivi: 'kodilla', Ablatiivi: 'kodilta', Allatiivi: 'kodille', Essiivi: 'kotona', Translatiivi: 'kodiksi', Abessiivi: 'koditta', Komitatiivi: 'koteineen', Instruktiivi: 'kodein' },
              pl: { Nominatiivi: 'kodit', Genetiivi: 'kotien', Akkusatiivi: 'kodit', Partitiivi: 'koteja', Inessiivi: 'kodeissa', Elatiivi: 'kodeista', Illatiivi: 'koteihin', Adessiivi: 'kodeilla', Ablatiivi: 'kodeilta', Allatiivi: 'kodeille', Essiivi: 'koteina', Translatiivi: 'kodeiksi', Abessiivi: 'kodeitta', Komitatiivi: 'koteineen', Instruktiivi: 'kodein' }
            }
        ];

        const SG_PL_SAME = new Set(['Komitatiivi', 'Instruktiivi']);

        let currentWord = WORDS[0], currentNum = 'sg', isPaused = false;

        function init() {
            renderWordList();
            renderCases();
            updateCaseContent();
            updateEmoji();
            updateGenetiiviPosition();
            togglePlay(false);
        }

        function togglePlay(p) {
            isPaused = p;
            document.documentElement.style.setProperty('--ani-play-state', isPaused ? 'paused' : 'running');
            document.getElementById('play-btn-tab').classList.toggle('active', !isPaused);
            document.getElementById('pause-btn-tab').classList.toggle('active', isPaused);
        }

        function setNumber(n) {
            currentNum = n;
            document.getElementById('sg-btn').classList.toggle('active', n === 'sg');
            document.getElementById('pl-btn').classList.toggle('active', n === 'pl');
            updateGenetiiviPosition();
            updateCaseContent();
            updateEmoji();
        }

        function updateGenetiiviPosition() {
            const el = document.getElementById('node-Genetiivi');
            if (!el) return;
            el.classList.toggle('num-sg', currentNum === 'sg');
            el.classList.toggle('num-pl', currentNum === 'pl');
        }

        function speak(t) {
            if (!t) return;
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(t);
            u.lang = 'fi-FI';
            window.speechSynthesis.speak(u);
        }

        function renderWordList() {
            const list = document.getElementById('word-list');
            list.innerHTML = '';
            WORDS.forEach(w => {
                const btn = document.createElement('button');
                btn.className = `word-btn ${currentWord.id === w.id ? 'active' : ''}`;
                btn.innerHTML = `<span class="text-xl">${w.emoji}</span><div class="text-left"><div class="text-sm font-black text-white">${w.base}</div><div class="text-[9px] text-slate-500 font-bold">${w.meaning}</div></div>`;
                btn.onclick = () => { currentWord = w; renderWordList(); updateCaseContent(); updateEmoji(); };
                list.appendChild(btn);
            });
        }

        function renderCases() {
            const container = document.getElementById('case-layer');
            container.innerHTML = '';
            CASE_CONFIGS.forEach(c => {
                const card = document.createElement('div');
                const extra = SG_PL_SAME.has(c.id) ? ' sg-pl-same' : '';
                card.className = `case-card ${c.class}${extra}`;
                card.id = `node-${c.id}`;
                card.innerHTML = `<div class="case-name" style="color:${c.color}">${c.name}</div><div class="case-word"></div><div class="case-desc">${c.desc}</div>`;
                container.appendChild(card);
            });
            updateGenetiiviPosition();
        }

        function formatWord(text, configId) {
            if (!text) return '';
            const val = text;

            // Genetiivi/Akkusatiivi „ÅØË™ûÂ∞æ„ÅåÂøÖ„Åö -n „ÅÆ„Åø
            if (configId === 'Genetiivi' || configId === 'Akkusatiivi') {
                return renderSpan(val.slice(0, -1), 'n', val);
            }

            // Nominatiivi „ÅØÊé•Â∞æËæû„Å™„Åó
            if (configId === 'Nominatiivi') {
                return renderSpan(val, '', val);
            }

            const suffixes = [
                'neen', 'tten', 'seen',
                'ien', 'jen', 'den',
                'illa', 'ill√§', 'ilta', 'ilt√§', 'ille',
                'issa', 'iss√§', 'ista', 'ist√§',
                'iksi', 'itta', 'itt√§',
                'ssa', 'ss√§', 'sta', 'st√§',
                'lla', 'll√§', 'lta', 'lt√§',
                'tta', 'tt√§',
                // ÂÖ•Ê†º: Èï∑ÊØçÈü≥+n „ÇíÂÖà„Å´Ôºàtaloon ‚Üí talo+on„ÄÅtalon „Å®„ÅØÂà•Ôºâ
                'oon', 'aan', 'een', 'iin', 'uun', '√§√§n', '√∂√∂n', 'yyn',
                'lle', 'ksi', 'na', 'n√§',
                'ja', 'ia', 'j√§', 'i√§',
                'it', 'at', 'ut', 'yt',
                'n', 't'
            ];

            let root = val, suf = '';
            for (const s of suffixes) {
                if (val.endsWith(s)) {
                    root = val.slice(0, -s.length);
                    suf  = s;
                    break;
                }
            }
            return renderSpan(root, suf, val);
        }

        function renderSpan(root, suf, val) {
            let r = root;
            if (currentWord.kpt) {
                const { s, w } = currentWord.kpt;
                if (r.includes(s)) {
                    r = r.replace(s, `<span class="strong-grade">${s}</span>`);
                } else if (r.includes(w)) {
                    r = r.replace(w, `<span class="weak-grade">${w}</span>`);
                }
            }
            return `<span>${r}<span class="suffix">${suf}</span></span> <span class="tts-icon" onclick="event.stopPropagation();speak('${val}')">üîä</span>`;
        }

        function updateCaseContent() {
            CASE_CONFIGS.forEach(c => {
                const el  = document.getElementById(`node-${c.id}`);
                const val = (currentWord[currentNum] && currentWord[currentNum][c.id]) || '';
                el.onclick = () => speak(val);
                el.querySelector('.case-word').innerHTML = formatWord(val, c.id);
            });
        }

        function updateEmoji() {
            const ec = document.getElementById('emoji-container');
            ec.className = `emoji-container ${currentNum}`;
            ec.innerHTML  = (currentNum === 'sg' ? [1] : [1,2,3,4]).map(() => `<span>${currentWord.emoji}</span>`).join('');
        }

        window.onload = init;
    </script>


<!-- </body> „ÅÆÁõ¥Ââç„Å´ËøΩÂä† -->
<script src="https://shared-components-be4c86.gitlab.io/ga.js"></script>

<script src="https://shared-components-be4c86.gitlab.io/footer.js"></script>
<shared-footer version="v20260223.1" project="sijamuoto_compass"></shared-footer>

</body>
</html>
