# https://copilot.microsoft.com/chats/6RoHHiA64xUYDBZGkeaSo


<!doctype html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <title>Dopamine-like RPE Prototype</title>
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            margin-top: 40px;
        }

        button {
            margin: 10px;
            padding: 10px 20px;
        }

        #feedback {
            font-size: 1.5rem;
            margin-top: 20px;
            min-height: 2em;
            transition: transform .2s;
        }

        .big {
            transform: scale(1.4);
            color: gold;
        }
    </style>
</head>

<body>
    <h1>Prediction Error Prototype</h1>
    <p>どちらかを選んで、報酬と誤差を観察してみてください。</p>
    <button id="choiceA">選択 A</button>
    <button id="choiceB">選択 B</button>

    <div id="feedback"></div>
    <div id="log"></div>

    <script>
        // 内部的な期待値（プレイヤーには直接見せなくてもよい）
        let expected = { A: 3.0, B: 1.0 };  // 最初の「期待価値」
        const learningRate = 0.2;

        function step(choice) {
            // 実際の報酬: 期待値 ± 乱数 で多少ブレさせる
            const base = choice === 'A' ? 3 : 1;
            const reward = base + (Math.random() * 2 - 1); // おおよそ base±1

            const pe = reward - expected[choice]; // prediction error

            // 期待値を更新（非常に簡略化したTD学習）
            expected[choice] += learningRate * pe;

            renderFeedback(reward, pe, choice);
        }

        function renderFeedback(reward, pe, choice) {
            const fb = document.getElementById('feedback');
            const log = document.getElementById('log');

            const surprise = Math.abs(pe);
            const positive = pe > 0;

            fb.classList.remove('big');

            let msg = `選択 ${choice}：報酬 ${reward.toFixed(2)}（予測誤差 ${pe.toFixed(2)}）`;
            fb.textContent = msg;

            // 「予想より良い結果」のときだけ強いフィードバック
            if (positive && surprise > 0.5) {
                fb.classList.add('big');
                // ここで効果音やパーティクルアニメを入れてもよい
            }

            log.textContent = `期待値 A=${expected.A.toFixed(2)} / B=${expected.B.toFixed(2)}`;
        }

        document.getElementById('choiceA').onclick = () => step('A');
        document.getElementById('choiceB').onclick = () => step('B');
    </script>
</body>

</html>