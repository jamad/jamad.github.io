<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>English Quiz</title>

    <style>
        :root {
            --bg: #121212;
            --fg: #e0e0e0;
            --card: #1e1e1e;
            --accent: #4caf50;
            --wrong: #f44336;
            --warn: #ff9800;
        }

        body {
            margin: 0;
            background: var(--bg);
            color: var(--fg);
            font-family: system-ui, sans-serif;
            display: flex;
            justify-content: center;
        }

        #app {
            max-width: 520px;
            width: 100%;
            padding: 20px;
        }

        h1 {
            margin-top: 0;
        }

        #progress-track {
            font-family: monospace;
            letter-spacing: 4px;
            margin-bottom: 8px;
        }

        #question {
            background: var(--card);
            padding: 24px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 1.6em;
            text-align: center;
        }

        #choices {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        button {
            padding: 12px;
            font-size: 1em;
            border-radius: 6px;
            border: none;
            background: #333;
            color: var(--fg);
            cursor: pointer;
        }

        button:hover {
            background: #444;
        }

        button.correct {
            background: var(--accent);
        }

        button.wrong {
            background: var(--wrong);
        }

        .secondary {
            margin-top: 12px;
            background: transparent;
            border: 1px solid #555;
        }

        .word-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .word-chip {
            padding: 6px 10px;
            border-radius: 6px;
            background: #333;
        }

        .word-chip.issue {
            background: var(--warn);
            color: #000;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div id="app">
        <h1>English Quiz</h1>
        <div id="progress-text"></div>
        <div id="progress-track"></div>
        <div id="main"></div>
    </div>

    <script>
        const TOTAL = 10;
        let words = [];
        let index = 0;

        const track = Array(TOTAL).fill("*");
        const correct = [];
        const wrong = [];
        const issues = [];

        fetch("concepts.json")
            .then(r => r.json())
            .then(data => {
                words = shuffle(Object.values(data)).slice(0, TOTAL);
                updateProgress();
                showQuestion();
            })
            .catch(() => {
                document.getElementById("main").textContent =
                    "Failed to load concepts.json";
            });

        function showQuestion() {
            const w = words[index];

            document.getElementById("progress-text").textContent =
                `Question ${index + 1} / ${TOTAL}`;

            const choices = shuffle([
                w.en,
                ...shuffle(words)
                    .filter(x => x.id !== w.id)
                    .slice(0, 3)
                    .map(x => x.en)
            ]);

            document.getElementById("main").innerHTML = `
    <div id="question">${w.ja}</div>
    <div id="choices">
      ${choices.map(c =>
                `<button onclick="answer('${c}')">${c}</button>`
            ).join("")}
    </div>
    <button class="secondary" onclick="markIssue()">âš  Problem</button>
  `;
        }

        function answer(choice) {
            const w = words[index];
            const buttons = [...document.querySelectorAll("#choices button")];

            buttons.forEach(b => {
                if (b.textContent === w.ja) b.classList.add("correct");
                else if (b.textContent === choice) b.classList.add("wrong");
                b.disabled = true;
            });

            if (choice === w.en) {
                track[index] = "O";
                correct.push(w);
            } else {
                track[index] = "X";
                wrong.push(w);
            }

            updateProgress();
            setTimeout(next, 1000);
        }

        function markIssue() {
            issues.push(words[index]);
            track[index] = "X";
            updateProgress();
            next();
        }

        function next() {
            index++;
            if (index >= TOTAL) showResult();
            else showQuestion();
        }

        function showResult() {
            document.getElementById("progress-text").textContent =
                "ðŸŽ‰ Session Finished";

            document.getElementById("main").innerHTML = `
    <h3>Correct</h3>
    <div class="word-list">
      ${correct.map(w => `<span class="word-chip">${w.en}</span>`).join("")}
    </div>

    <h3>Wrong</h3>
    <div class="word-list">
      ${wrong.map(w => `<span class="word-chip">${w.en}</span>`).join("")}
    </div>

    <h3>âš  Problems</h3>
    <div class="word-list">
      ${issues.map(w =>
                `<span class="word-chip issue"
          onclick="reportIssue('${w.en}','${w.ja}')">
          ${w.en}
        </span>`
            ).join("")}
    </div>
  `;
        }

        function reportIssue(en, ja) {
            const page =
                "https://jamad.github.io/quiz_vocabulary/index_en.html";

            const url =
                "https://github.com/jamad/jamad.github.io/issues/new" +
                "?title=" + encodeURIComponent(`[quiz_vocabulary] ${en}`) +
                "&body=" + encodeURIComponent(
                    `Page: ${page}\nWord: ${en}\nMeaning: ${ja}\n\nProblem:`
                );

            window.open(url, "_blank");
        }

        function updateProgress() {
            document.getElementById("progress-track").textContent = track.join("");
        }

        function shuffle(arr) {
            return [...arr].sort(() => Math.random() - 0.5);
        }
    </script>
</body>

</html>