<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>EM-Prototype v0.1</title>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
        }
    </style>
</head>

<body>
    <canvas id="c"></canvas>
    <script>
        const canvas = document.getElementById("c");
        const gl = canvas.getContext("webgl2");
        canvas.width = innerWidth;
        canvas.height = innerHeight;

        const frag = `
#version 300 es
precision highp float;
out vec4 fragColor;
uniform vec3  iResolution;
uniform float iTime;
uniform vec4  iMouse;

vec2 uv(in vec2 fragCoord) {
    return (fragCoord - 0.5 * iResolution.xy) / iResolution.y;
}
vec2 force(vec2 p, vec2 c, float q1, float q2) {
    vec2 d = c - p;
    float r = max(length(d), 0.02);
    return normalize(d) * (q1 * q2) / (r * r);
}

void main(){
    vec2 fragCoord = gl_FragCoord.xy;
    vec2 p = uv(fragCoord);

    vec2 posA = vec2(-0.5, 0.0);
    vec2 posB = vec2( 0.5, 0.0);
    float qA = 1.0;
    float qB = -1.0;

    float t = iTime;
    vec2 player = vec2(0.3 * cos(t), 0.3 * sin(t));

    float qPlayer = (iMouse.z > 0.0) ? -1.0 : 1.0;

    float c = 0.0;
    c += 0.002 / length(p - posA);
    c += 0.002 / length(p - posB);
    c += 0.02  / length(p - player);

    fragColor = vec4(vec3(c), 1.0);
}
`;

        const vs = `#version 300 es
in vec4 a;
void main(){gl_Position=a;}
`;

        function compile(type, src) {
            const s = gl.createShader(type); gl.shaderSource(s, src); gl.compileShader(s);
            if (!gl.getShaderParameter(s, gl.COMPILE_STATUS)) console.log(gl.getShaderInfoLog(s));
            return s;
        }

        const prog = gl.createProgram();
        gl.attachShader(prog, compile(gl.VERTEX_SHADER, vs));
        gl.attachShader(prog, compile(gl.FRAGMENT_SHADER, frag));
        gl.linkProgram(prog);
        gl.useProgram(prog);

        const quad = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, quad);
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1, -1, 1, -1, -1, 1, 1, 1]), gl.STATIC_DRAW);
        const loc = gl.getAttribLocation(prog, "a");
        gl.enableVertexAttribArray(loc);
        gl.vertexAttribPointer(loc, 2, gl.FLOAT, false, 0, 0);

        const iResolution = gl.getUniformLocation(prog, "iResolution");
        const iTime = gl.getUniformLocation(prog, "iTime");
        const iMouse = gl.getUniformLocation(prog, "iMouse");

        let mouse = [0, 0, 0, 0];
        canvas.addEventListener("mousedown", () => { mouse[2] = 1; });
        canvas.addEventListener("mouseup", () => { mouse[2] = 0; });

        function loop(t) {
            gl.uniform3f(iResolution, canvas.width, canvas.height, 1.);
            gl.uniform1f(iTime, t * 0.001);
            gl.uniform4f(iMouse, mouse[0], mouse[1], mouse[2], mouse[3]);

            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
            requestAnimationFrame(loop);
        }
        loop(0);
    </script>
</body>

</html>